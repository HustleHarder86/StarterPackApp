<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROI Finder - Test Version</title>
    
    <!-- CSS Files -->

    <!-- React from CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Unified Design System -->
    <link rel="stylesheet" href="/styles/unified-design-system.css">
    <link rel="stylesheet" href="/styles/property-confirmation.css">
    <link rel="stylesheet" href="/styles/analysis-progress.css">
    </head>
<body>
    <div id="root"></div>
    
    <!-- Combined Component Loader for Testing -->
    <script>
        // Mock Firebase for test mode
        const urlParams = new URLSearchParams(window.location.search);
        const isTestMode = urlParams.get('e2e_test_mode') === 'true';
        
        if (isTestMode) {
            console.log('[TEST MODE] Running in E2E test mode');
            window.firebase = {
                auth: () => ({
                    onAuthStateChanged: (callback) => {
                        callback({ uid: 'test-user', email: 'test@example.com' });
                    },
                    signOut: () => Promise.resolve()
                }),
                firestore: () => ({
                    collection: () => ({
                        doc: () => ({
                            get: () => Promise.resolve({ exists: () => false }),
                            set: () => Promise.resolve()
                        })
                    })
                }),
                initializeApp: () => {}
            };
        }
        
        // Basic ComponentLoader class
        class ComponentLoader {
            constructor() {
                console.log('[ComponentLoader] Initialized');
            }
        }
        
        // CompactModern extension
        class ComponentLoaderCompactModern extends ComponentLoader {
            constructor() {
                super();
                console.log('[ComponentLoaderCompactModern] Initialized');
            }
        }
        
        // Mock components
        window.ComponentLoader = ComponentLoader;
        window.ComponentLoaderCompactModern = ComponentLoaderCompactModern;
        window.CompactModernLayout = function() {};
        window.PropertyHeroSection = function() {};
        window.FinancialSummaryCompactModern = function() {};
        window.InvestmentVerdictCompactModern = function() {};
        window.MarketComparisonCompactModern = function() {};
        
        // Initialize on DOM ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('[INIT] DOM loaded, initializing application');
            
            // Verify all components
            const componentsToCheck = [
                'ComponentLoader',
                'ComponentLoaderCompactModern',
                'CompactModernLayout',
                'PropertyHeroSection',
                'FinancialSummaryCompactModern',
                'InvestmentVerdictCompactModern',
                'MarketComparisonCompactModern'
            ];
            
            const missingComponents = componentsToCheck.filter(name => !window[name]);
            if (missingComponents.length > 0) {
                console.error('[INIT] Missing components:', missingComponents);
                return;
            }
            
            console.log('[INIT] All components loaded successfully');
            
            // Initialize component loader
            window.componentLoader = new window.ComponentLoaderCompactModern();
            console.log('[INIT] Component loader initialized');
            
            // Render test UI
            const root = document.getElementById('root');
            root.innerHTML = `
                <div class="cm-layout-wrapper">
                    <aside class="cm-sidebar" id="sidebarContainer">
                        <div class="cm-sidebar-header">
                            <h1 class="cm-logo">ROI Finder</h1>
                        </div>
                    </aside>
                    
                    <main class="cm-main-content">
                        <div class="cm-content-container">
                            <h1 class="cm-page-title">Property Analysis</h1>
                            
                            <form id="property-form">
                                <input type="text" id="address" name="address" placeholder="Address" required>
                                <input type="text" id="city" name="city" placeholder="City" required>
                                <input type="number" id="price" name="price" placeholder="Price" required>
                                <button type="submit">Analyze Property</button>
                            </form>
                            
                            <div id="results-container"></div>
                        </div>
                    </main>
                </div>
            `;
            
            // Add form handler
            document.getElementById('property-form').addEventListener('submit', function(e) {
                e.preventDefault();
                console.log('[FORM] Form submitted');
                document.getElementById('results-container').innerHTML = 
                    '<div class="cm-success">Analysis complete!</div>';
            });
            
            console.log('[INIT] Application initialized successfully');
        });
    </script>
</body>
</html>