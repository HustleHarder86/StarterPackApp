<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STR Components Test with Mock Data</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        // Mock analysis data with STR data
        const mockAnalysisData = {
            success: true,
            propertyData: {
                address: "123 King Street West, Unit 1205, Toronto, ON M5H 1A1",
                price: 850000,
                bedrooms: 2,
                bathrooms: 2,
                squareFootage: 1100,
                propertyTaxes: 5400,
                condoFees: 650,
                propertyType: "condo",
                mainImage: "https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?w=600&h=400&fit=crop"
            },
            costs: {
                property_tax_annual: 5400,
                insurance: 132,
                hoa_monthly: 650,
                mortgage: 3975
            },
            monthlyExpenses: {
                mortgage: 3975,
                property_tax: 450,
                insurance: 132,
                hoa: 650,
                utilities: 150,
                maintenance: 265
            },
            longTermRental: {
                monthly_rent: 3000,
                occupancy_rate: 0.95
            },
            strAnalysis: {
                monthly_revenue: 5400,
                avg_nightly_rate: 180,
                occupancy_rate: 0.85,
                comparables: [
                    {
                        name: "Luxury 2BR Downtown Condo",
                        url: "https://airbnb.com/rooms/12345",
                        roomType: "Entire home/apt",
                        bedrooms: 2,
                        bathrooms: 2,
                        price: 220,
                        rating: 4.9,
                        numberOfReviews: 327,
                        address: "Similar neighborhood",
                        images: ["https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?w=600&h=400&fit=crop"],
                        occupancy: 0.98,
                        revenue_potential: 6400,
                        badge: "TOP PERFORMER"
                    },
                    {
                        name: "Modern 2BR with City Views",
                        url: "https://airbnb.com/rooms/12346",
                        roomType: "Entire home/apt",
                        bedrooms: 2,
                        bathrooms: 2,
                        price: 185,
                        rating: 4.7,
                        numberOfReviews: 89,
                        address: "Same building",
                        images: ["https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=600&h=400&fit=crop"],
                        occupancy: 0.85,
                        revenue_potential: 5200,
                        badge: "MOST SIMILAR"
                    },
                    {
                        name: "Cozy Downtown Apartment",
                        url: "https://airbnb.com/rooms/12347",
                        roomType: "Entire home/apt",
                        bedrooms: 2,
                        bathrooms: 1.5,
                        price: 145,
                        rating: 4.5,
                        numberOfReviews: 156,
                        address: "2 blocks away",
                        images: ["https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?w=600&h=400&fit=crop"],
                        occupancy: 0.72,
                        revenue_potential: 3800,
                        badge: "VALUE OPTION"
                    }
                ]
            }
        };

        // Components
        const PropertyHeader = ({ propertyData }) => (
            <div className="bg-gradient-to-r from-purple-600 to-pink-600 rounded-xl p-6 text-white mb-6">
                <div className="flex items-start gap-6">
                    <img 
                        src={propertyData.mainImage} 
                        alt="Property" 
                        className="w-48 h-36 rounded-lg shadow-lg object-cover"
                    />
                    <div className="flex-1">
                        <h2 className="text-2xl font-bold mb-2">{propertyData.address}</h2>
                        <p className="text-purple-100 mb-4">
                            {propertyData.bedrooms} Bedrooms • {propertyData.bathrooms} Bathrooms • 
                            {propertyData.squareFootage} sq ft • {propertyData.propertyType}
                        </p>
                        <div className="flex items-center gap-4">
                            <span className="inline-flex items-center gap-1 px-3 py-1 bg-white/20 backdrop-blur text-white text-sm font-bold rounded">
                                <span className="inline-block animate-pulse">●</span>
                                LIVE DATA
                            </span>
                            <span className="text-sm">Analysis performed: {new Date().toLocaleDateString()}</span>
                        </div>
                    </div>
                </div>
            </div>
        );

        const AirbnbListings = ({ comparables }) => (
            <div className="bg-white rounded-xl shadow-sm p-6 mb-6">
                <div className="flex items-center justify-between mb-4">
                    <div className="flex items-center gap-3">
                        <h3 className="text-lg font-bold text-gray-900">Live Airbnb Market Data</h3>
                        <span className="text-green-600 text-sm font-medium">● {comparables.length} active listings found</span>
                    </div>
                    <span className="text-xs text-gray-500">Updated 3 minutes ago</span>
                </div>

                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
                    {comparables.map((listing, index) => (
                        <div key={index} className="bg-white rounded-lg overflow-hidden border border-gray-200 hover:shadow-xl transition-all">
                            <div className="relative h-48">
                                <img src={listing.images[0]} className="w-full h-full object-cover" />
                                <div className="absolute top-3 left-3">
                                    <span className={`px-2 py-1 text-white text-xs font-bold rounded
                                        ${listing.badge === 'TOP PERFORMER' ? 'bg-green-500' : 
                                          listing.badge === 'MOST SIMILAR' ? 'bg-blue-600' : 'bg-orange-500'}`}>
                                        {listing.badge}
                                    </span>
                                </div>
                                <div className="absolute top-3 right-3 bg-black/70 backdrop-blur text-white px-2 py-1 rounded text-xs font-bold">
                                    ${listing.price}/night
                                </div>
                            </div>
                            <div className="p-4">
                                <div className="flex items-center justify-between mb-2">
                                    <span className="font-bold text-gray-900">
                                        {listing.bedrooms}BR • {listing.bathrooms}BA
                                    </span>
                                    <span className="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">
                                        {Math.round(listing.occupancy * 100)}% booked
                                    </span>
                                </div>
                                <p className="text-sm text-gray-600 mb-3">{listing.address}</p>
                                <div className="flex items-center justify-between">
                                    <span className="text-sm font-medium text-gray-700">
                                        {listing.rating}★ ({listing.numberOfReviews})
                                    </span>
                                    <div className="text-right">
                                        <div className="text-green-600 font-bold">
                                            +${listing.revenue_potential.toLocaleString()}
                                        </div>
                                        <div className="text-xs text-gray-500">revenue/mo</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ))}
                </div>

                <div className="text-center">
                    <button className="px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg hover:shadow-lg transition-all">
                        View All Properties
                    </button>
                </div>
            </div>
        );

        const STRRevenueCalculator = ({ defaultRate = 180, defaultOccupancy = 85 }) => {
            const [nightlyRate, setNightlyRate] = React.useState(defaultRate);
            const [occupancy, setOccupancy] = React.useState(defaultOccupancy);

            const monthlyRevenue = Math.round((nightlyRate * 30 * occupancy) / 100);
            const annualRevenue = monthlyRevenue * 12;

            return (
                <div className="bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-6 shadow-sm">
                    <h3 className="text-lg font-bold text-gray-900 mb-4">STR Revenue Calculator</h3>
                    
                    <div className="mb-6">
                        <div className="flex justify-between mb-2">
                            <label className="text-sm font-medium text-gray-700">Average Nightly Rate</label>
                            <span className="text-xl font-bold text-purple-600">${nightlyRate}</span>
                        </div>
                        <input 
                            type="range" 
                            min="100" 
                            max="300" 
                            value={nightlyRate}
                            onChange={(e) => setNightlyRate(e.target.value)}
                            className="w-full h-2 bg-purple-200 rounded-lg appearance-none cursor-pointer"
                        />
                    </div>

                    <div className="mb-6">
                        <div className="flex justify-between mb-2">
                            <label className="text-sm font-medium text-gray-700">Occupancy Rate</label>
                            <span className="text-xl font-bold text-pink-600">{occupancy}%</span>
                        </div>
                        <input 
                            type="range" 
                            min="50" 
                            max="100" 
                            value={occupancy}
                            onChange={(e) => setOccupancy(e.target.value)}
                            className="w-full h-2 bg-pink-200 rounded-lg appearance-none cursor-pointer"
                        />
                    </div>

                    <div className="bg-white rounded-lg p-4 space-y-3">
                        <div className="flex justify-between items-center">
                            <span className="text-sm text-gray-600">Monthly Revenue</span>
                            <span className="text-xl font-bold text-gray-900">${monthlyRevenue.toLocaleString()}</span>
                        </div>
                        <div className="flex justify-between items-center">
                            <span className="text-sm text-gray-600">Annual Revenue</span>
                            <span className="text-2xl font-bold text-green-600">${annualRevenue.toLocaleString()}</span>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [showFloatingButton, setShowFloatingButton] = React.useState(false);

            React.useEffect(() => {
                const handleScroll = () => {
                    const calculator = document.getElementById('financial-calculator');
                    if (calculator) {
                        const rect = calculator.getBoundingClientRect();
                        setShowFloatingButton(rect.bottom < 0);
                    }
                };

                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            const scrollToCalculator = () => {
                const calculator = document.getElementById('financial-calculator');
                if (calculator) {
                    calculator.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            };

            return (
                <div className="max-w-7xl mx-auto p-6">
                    <h1 className="text-3xl font-bold mb-6">STR Analysis Components Test</h1>
                    
                    <PropertyHeader propertyData={mockAnalysisData.propertyData} />
                    
                    <AirbnbListings comparables={mockAnalysisData.strAnalysis.comparables} />
                    
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div className="bg-white rounded-xl p-6 shadow-sm">
                            <h3 className="text-lg font-bold text-gray-900 mb-4">Annual Revenue Comparison</h3>
                            <canvas id="revenue-chart"></canvas>
                        </div>
                        
                        <STRRevenueCalculator 
                            defaultRate={mockAnalysisData.strAnalysis.avg_nightly_rate}
                            defaultOccupancy={mockAnalysisData.strAnalysis.occupancy_rate * 100}
                        />
                    </div>

                    <div id="financial-calculator" className="bg-white rounded-xl p-6 shadow-sm mb-6">
                        <h2 className="text-2xl font-bold mb-4">Enhanced Financial Calculator (STR Mode)</h2>
                        <div className="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                            <div className="bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-4">
                                <p className="text-sm text-green-700 font-medium">Monthly Cash Flow</p>
                                <p className="text-2xl font-bold text-green-700">+$1,265</p>
                            </div>
                            <div className="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-4">
                                <p className="text-sm text-blue-700 font-medium">Annual ROI</p>
                                <p className="text-2xl font-bold text-blue-700">8.9%</p>
                            </div>
                            <div className="bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-4">
                                <p className="text-sm text-purple-700 font-medium">Cap Rate</p>
                                <p className="text-2xl font-bold text-purple-700">4.8%</p>
                            </div>
                            <div className="bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg p-4">
                                <p className="text-sm text-orange-700 font-medium">Break-Even</p>
                                <p className="text-2xl font-bold text-orange-700">6.2 years</p>
                            </div>
                        </div>
                        
                        <button className="w-full bg-blue-50 rounded-lg p-4 border border-blue-200 hover:bg-blue-100 transition-colors">
                            <div className="flex items-center justify-between">
                                <h3 className="text-base font-semibold text-blue-900">
                                    View Financial Assumptions & Calculator Details
                                </h3>
                                <svg className="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7"/>
                                </svg>
                            </div>
                        </button>
                    </div>

                    {showFloatingButton && (
                        <button 
                            onClick={scrollToCalculator}
                            className="fixed bottom-8 right-8 bg-gradient-to-r from-purple-600 to-purple-700 text-white px-6 py-3 rounded-full shadow-lg hover:shadow-xl transform transition-all duration-200 hover:scale-105 flex items-center gap-2"
                        >
                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            Change Assumptions
                        </button>
                    )}
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));

        // Initialize revenue comparison chart
        setTimeout(() => {
            const ctx = document.getElementById('revenue-chart');
            if (ctx) {
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Short-Term Rental', 'Long-Term Rental'],
                        datasets: [{
                            data: [5400, 3000],
                            backgroundColor: ['#10b981', '#3b82f6']
                        }]
                    },
                    options: {
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '$' + value.toLocaleString();
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }, 100);
    </script>
</body>
</html>