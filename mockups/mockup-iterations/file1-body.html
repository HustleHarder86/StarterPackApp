<!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div>
                    <h1 class="h2">STR Analysis UX Redesign Mockup V3</h1>
                    <p class="small">Optional financing toggle with proper mortgage calculations</p>
                </div>
                <div style="display: flex; align-items: center; gap: 16px;">
                    <span class="version-badge">FINANCING OPTIONS</span>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Data Reception Area -->
    <section id="data-reception-area" style="background: white; box-shadow: var(--shadow-sm); margin-bottom: 32px; display: none;">
        <div class="container">
            <div style="padding: 24px 0;">
                <div style="max-width: 800px; margin: 0 auto; text-align: center;">
                    <div id="loading-message" style="display: none;">
                        <div style="display: inline-block; padding: 16px 24px; background: var(--gradient-primary); color: white; border-radius: var(--radius-md); font-weight: 600;">
                            <span style="display: inline-block; animation: pulse 1.5s infinite;">‚è≥</span>
                            <span style="margin-left: 8px;">Loading property data...</span>
                        </div>
                    </div>
                    <div id="property-loaded-message" style="display: none;">
                        <div style="display: inline-block; padding: 16px 24px; background: linear-gradient(135deg, #10B981, #065F46); color: white; border-radius: var(--radius-md); font-weight: 600;">
                            <span>‚úì</span>
                            <span style="margin-left: 8px;">Property data loaded: <span id="loaded-address"></span></span>
                        </div>
                    </div>
                    <div id="error-message" style="display: none;">
                        <div style="display: inline-block; padding: 16px 24px; background: linear-gradient(135deg, #EF4444, #991B1B); color: white; border-radius: var(--radius-md); font-weight: 600;">
                            <span>‚ö†Ô∏è</span>
                            <span style="margin-left: 8px;">No property data received</span>
                        </div>
                    </div>
                    <p style="font-size: 12px; color: var(--gray-500); margin-top: 8px;">
                        üîç Live data analysis with AI-enhanced market research
                    </p>
                </div>
            </div>
        </div>
    </section>
    
    <script>
        // Data Reception Logic for Integration Testing
        (function() {
            const reception = document.getElementById('data-reception-area');
            const loadingMsg = document.getElementById('loading-message');
            const loadedMsg = document.getElementById('property-loaded-message');
            const errorMsg = document.getElementById('error-message');
            const addressSpan = document.getElementById('loaded-address');
            
            // Check for property data from various sources
            function checkForPropertyData() {
                reception.style.display = 'block';
                loadingMsg.style.display = 'block';
                
                // Check URL parameters
                const urlParams = new URLSearchParams(window.location.search);
                let propertyData = null;
                
                // Source 1: URL parameters
                if (urlParams.has('propertyData')) {
                    try {
                        propertyData = JSON.parse(decodeURIComponent(urlParams.get('propertyData')));
                        console.log('[Integration] Property data received from URL params:', propertyData);
                    } catch (e) {
                        console.error('[Integration] Failed to parse URL property data:', e);
                    }
                }
                
                // Source 2: SessionStorage
                if (!propertyData && sessionStorage.getItem('propertyData')) {
                    try {
                        propertyData = JSON.parse(sessionStorage.getItem('propertyData'));
                        console.log('[Integration] Property data received from sessionStorage:', propertyData);
                    } catch (e) {
                        console.error('[Integration] Failed to parse sessionStorage data:', e);
                    }
                }
                
                // Source 3: LocalStorage (for saved properties)
                if (!propertyData && localStorage.getItem('currentPropertyData')) {
                    try {
                        propertyData = JSON.parse(localStorage.getItem('currentPropertyData'));
                        console.log('[Integration] Property data received from localStorage:', propertyData);
                    } catch (e) {
                        console.error('[Integration] Failed to parse localStorage data:', e);
                    }
                }
                
                // Process received data
                if (propertyData) {
                    loadingMsg.style.display = 'none';
                    loadedMsg.style.display = 'block';
                    addressSpan.textContent = propertyData.address || 'Property loaded';
                    
                    // Trigger data population in the mockup
                    setTimeout(async () => {
                        // Check if we have the property API available
                        if (window.propertyAPI && propertyData.address) {
                            console.log('[Integration] Starting live API analysis for:', propertyData.address);
                            
                            try {
                                // Show loading states
                                const sections = ['property-header', 'str-section', 'ltr-section'];
                                sections.forEach(id => {
                                    const elem = document.getElementById(id);
                                    if (elem) {
                                        elem.style.opacity = '0.5';
                                        elem.innerHTML = `<div style="padding: 20px; text-align: center;">
                                            <div style="display: inline-block; width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #8B5CF6; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                                            <p style="margin-top: 10px; color: #666;">Loading real data...</p>
                                        </div>`;
                                    }
                                });
                                
                                // Add spinning animation CSS if not already present
                                if (!document.getElementById('api-spinner-style')) {
                                    const style = document.createElement('style');
                                    style.id = 'api-spinner-style';
                                    style.textContent = '@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }';
                                    document.head.appendChild(style);
                                }
                                
                                // Perform the actual API call
                                const analysisType = urlParams.get('analysisType') || 'both';
                                const result = await window.propertyAPI.analyzeProperty(
                                    propertyData.address,
                                    {
                                        includeStr: analysisType === 'both' || analysisType === 'str',
                                        analysisType: analysisType,
                                        showLoading: false // We're handling loading states ourselves
                                    }
                                );
                                
                                console.log('[Integration] API analysis complete:', result);
                                
                                // Update the mockup with real data
                                if (result && result.data) {
                                    const properData = {
                                        property: result.data.property || {},
                                        analysis: result.data.analysis || {},
                                        strAnalysis: result.data.strAnalysis || {},
                                        data: result.data.data || result.data
                                    };
                                    
                                    // Update the mockup display
                                    if (window.propertyAPI.updateMockup) {
                                        window.propertyAPI.updateMockup(properData, 'base');
                                    }
                                    
                                    // Store the results
                                    sessionStorage.setItem('analysisResults', JSON.stringify(result));
                                    
                                    // Show success
                                    console.log('[Integration] Successfully updated with live API data');
                                }
                                
                            } catch (error) {
                                console.error('[Integration] API call failed:', error);
                                // Restore sections with error message
                                ['property-header', 'str-section', 'ltr-section'].forEach(id => {
                                    const elem = document.getElementById(id);
                                    if (elem) {
                                        elem.style.opacity = '1';
                                        elem.innerHTML = `<div style="padding: 20px; text-align: center; color: #EF4444;">
                                            <p>Failed to load live data. Using demo data.</p>
                                            <p style="font-size: 12px; margin-top: 5px;">${error.message}</p>
                                        </div>`;
                                    }
                                });
                            }
                        } else if (typeof populatePropertyData === 'function') {
                            populatePropertyData(propertyData);
                        } else {
                            console.warn('[Integration] No API or populate function available');
                        }
                        
                        // Hide the reception area after successful load
                        setTimeout(() => {
                            reception.style.display = 'none';
                        }, 2000);
                    }, 1000);
                } else {
                    // No data found
                    setTimeout(() => {
                        loadingMsg.style.display = 'none';
                        errorMsg.style.display = 'block';
                        console.error('[Integration] No property data found in any source');
                    }, 2000);
                }
            }
            
            // Check for data on page load
            window.addEventListener('DOMContentLoaded', checkForPropertyData);
            
            // Also expose function globally for manual triggering
            window.checkForPropertyData = checkForPropertyData;
        })();
    </script>
    
    <!-- Main Content with Sidebar -->
    <main class="main-content">
        <div class="container" style="max-width: 1400px;">
            <div style="display: flex; gap: 24px;">
                <!-- Sidebar Navigation -->
                <aside style="width: 280px; flex-shrink: 0;">
                    <div style="position: sticky; top: 20px;">
                        <div class="card" style="padding: 0; overflow: hidden;">
                            <!-- Sidebar Header -->
                            <div style="padding: 20px; background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%); color: white;">
                                <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 4px;">Analysis Navigation</h3>
                                <p style="font-size: 12px; opacity: 0.9;">1514 - 150 East Liberty St</p>
                            </div>
                            
                            <!-- Navigation Items -->
                            <nav style="padding: 12px;">
                                <button class="sidebar-nav-item active" onclick="handleNavClick(this, 'overview')">
                                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path>
                                    </svg>
                                    <span>Property Overview</span>
                                </button>
                                
                                <button class="sidebar-nav-item" onclick="handleNavClick(this, 'str')">
                                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"></path>
                                    </svg>
                                    <span>STR Analysis</span>
                                    <span class="nav-badge">Recommended</span>
                                </button>
                                
                                <button class="sidebar-nav-item" onclick="handleNavClick(this, 'ltr')">
                                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm3 1h6v4H7V5zm6 6H7v2h6v-2z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span>LTR Analysis</span>
                                </button>
                                
                                <button class="sidebar-nav-item" onclick="handleNavClick(this, 'financial')">
                                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"></path>
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span>Financial Calculator</span>
                                </button>
                                
                                <button class="sidebar-nav-item" onclick="handleNavClick(this, 'comparison')">
                                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M2 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1H3a1 1 0 01-1-1V4zM8 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1H9a1 1 0 01-1-1V4zM15 3a1 1 0 00-1 1v12a1 1 0 001 1h2a1 1 0 001-1V4a1 1 0 00-1-1h-2z"></path>
                                    </svg>
                                    <span>STR vs LTR</span>
                                </button>
                            </nav>
                            
                            <!-- Quick Actions -->
                            <div style="padding: 12px; border-top: 1px solid var(--gray-200);">
                                <button style="width: 100%; padding: 10px; background: var(--primary-blue); color: white; border: none; border-radius: 8px; font-weight: 500; cursor: pointer; margin-bottom: 8px;">
                                    üìÑ Generate PDF Report
                                </button>
                                <button style="width: 100%; padding: 10px; background: white; color: var(--gray-700); border: 1px solid var(--gray-300); border-radius: 8px; font-weight: 500; cursor: pointer;">
                                    üîó Share Analysis
                                </button>
                            </div>
                            
                            <!-- Collapse Toggle -->
                            <button onclick="toggleSidebar()" style="position: absolute; top: 20px; right: -12px; width: 24px; height: 24px; background: white; border: 1px solid var(--gray-300); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: var(--shadow-sm);">
                                <svg width="12" height="12" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </aside>
                
                <!-- Main Content Area -->
                <div style="flex: 1; min-width: 0;">
                    
            <!-- Data Source Legend -->
            <div class="data-source-legend">
                <div class="legend-item">
                    <span class="legend-dot live-api"></span>
                    <span>Live API Data</span>
                </div>
                <div class="legend-item">
                    <span class="legend-dot ai-enhanced"></span>
                    <span>AI-Enhanced Research</span>
                </div>
                <div class="legend-item">
                    <span class="legend-dot calculated"></span>
                    <span>Calculated Metrics</span>
                </div>
                <div class="legend-item">
                    <span class="legend-dot user-input"></span>
                    <span>User Configurable</span>
                </div>
            </div>
                    
            <!-- Property Hero Section (unchanged) -->
            <div class="card" id="property-header" data-section="property-header">
                <div class="property-hero">
                    <img src="https://images.unsplash.com/photo-1568605114967-8130f3a36994?w=600&h=400&fit=crop" 
                         alt="Property" 
                         class="property-image">
                    <div class="property-details">
                        <div class="property-address">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            <div>
                                <h1 class="h1 property-address" data-field="address">1514 - 150 East Liberty Street</h1>
                                <p class="body" data-field="full-address">Toronto, Ontario M6K 3R5</p>
                                <p class="h3 property-price" data-field="price" style="color: var(--primary-blue); margin-top: 8px;">$849,900</p>
                            </div>
                            <!-- Property Details -->
                            <div style="display: flex; gap: 12px; margin-top: 16px; flex-wrap: wrap;">
                                <span data-field="bedrooms" style="padding: 4px 8px; background: var(--gray-100); border-radius: 4px; font-size: 12px;">2 Bedrooms</span>
                                <span data-field="bathrooms" style="padding: 4px 8px; background: var(--gray-100); border-radius: 4px; font-size: 12px;">2 Bathrooms</span>
                                <span data-field="sqft" style="padding: 4px 8px; background: var(--gray-100); border-radius: 4px; font-size: 12px;">1,200 sq ft</span>
                            </div>
                        </div>
                        <div class="metric-cards" id="header-metrics">
                            <!-- Default STR Metrics -->
                            <div class="metric-card str-metric">
                                <div class="metric-card-label">Monthly Revenue <span class="data-source-badge live-api" style="font-size: 9px; padding: 1px 6px;">API</span></div>
                                <div class="metric-card-value positive" id="str-monthly-revenue">$11,044</div>
                            </div>
                            <div class="metric-card str-metric">
                                <div class="metric-card-label">Net Cash Flow <span class="data-source-badge calculated" style="font-size: 9px; padding: 1px 6px;">Calc</span></div>
                                <div class="metric-card-value positive" id="netCashFlowDisplay">+$8,500</div>
                            </div>
                            <div class="metric-card str-metric">
                                <div class="metric-card-label">ROI <span class="data-source-badge calculated" style="font-size: 9px; padding: 1px 6px;">Calc</span></div>
                                <div class="metric-card-value" id="roiDisplay">12.3%</div>
                            </div>
                            <div class="metric-card str-metric">
                                <div class="metric-card-label">Occupancy Rate <span class="data-source-badge live-api" style="font-size: 9px; padding: 1px 6px;">API</span></div>
                                <div class="metric-card-value" id="str-occupancy">75%</div>
                            </div>
                            <!-- LTR Market Statistics (Hidden by default) -->
                            <div class="metric-card ltr-metric" style="display: none;">
                                <div class="metric-card-label">Average monthly rent</div>
                                <div class="metric-card-value" id="ltr-monthly-rent">$3,950</div>
                                <div style="font-size: 11px; color: var(--gray-500); margin-top: 2px;" data-field="bedrooms">for 2BR units</div>
                            </div>
                            <div class="metric-card ltr-metric" style="display: none;">
                                <div class="metric-card-label">Vacancy rate</div>
                                <div class="metric-card-value" style="color: var(--primary-blue);" id="ltr-vacancy-rate">5%</div>
                                <div style="font-size: 11px; color: var(--gray-500); margin-top: 2px;">Toronto average</div>
                            </div>
                            <div class="metric-card ltr-metric" style="display: none;">
                                <div class="metric-card-label">Days on Market</div>
                                <div class="metric-card-value" style="color: var(--success-green);">12 days</div>
                                <div style="font-size: 11px; color: var(--gray-500); margin-top: 2px;">avg. listing duration</div>
                            </div>
                            <div class="metric-card ltr-metric" style="display: none;">
                                <div class="metric-card-label">Annual rent increase</div>
                                <div class="metric-card-value">3.2%</div>
                                <div style="font-size: 11px; color: var(--gray-500); margin-top: 2px;">market average</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Investment Grade Card - Shown only in Overview -->
            <div id="investment-grade-card" class="card" style="margin-top: 24px;">
                <div style="text-align: center; margin-bottom: 32px;">
                    <div style="display: inline-block; padding: 12px 24px; background: linear-gradient(135deg, #10B981, #065F46); color: white; border-radius: 12px; font-size: 48px; font-weight: 700; margin-bottom: 12px;">
                        B+
                    </div>
                    <h2 class="h2" style="margin-bottom: 8px;">Investment Grade: B+</h2>
                    <p style="color: var(--gray-600); font-size: 16px;">Strong LTR opportunity, STR restricted by regulations</p>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                    <!-- STR Grade Panel -->
                    <div style="padding: 24px; background: var(--gray-50); border-radius: 12px; border: 2px solid var(--gray-200);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 class="h3">Short-Term Rental (STR)</h3>
                            <div style="display: inline-block; padding: 8px 16px; background: linear-gradient(135deg, #EF4444, #991B1B); color: white; border-radius: 8px; font-size: 24px; font-weight: 700;">
                                D
                            </div>
                        </div>
                        
                        <!-- Progress Bar -->
                        <div style="background: var(--gray-300); height: 12px; border-radius: 6px; margin-bottom: 20px; overflow: hidden;">
                            <div style="width: 25%; height: 100%; background: linear-gradient(90deg, #EF4444, #F87171); border-radius: 6px;"></div>
                        </div>
                        
                        <!-- Key Factors -->
                        <div style="margin-bottom: 20px;">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                                <span style="font-size: 20px;">‚ùå</span>
                                <span style="font-size: 14px;"><strong>Zoning:</strong> Residential only - STR prohibited</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                                <span style="font-size: 20px;">‚ö†Ô∏è</span>
                                <span style="font-size: 14px;"><strong>HOA Rules:</strong> Min 30-day rentals required</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                                <span style="font-size: 20px;">‚ùå</span>
                                <span style="font-size: 14px;"><strong>Licensing:</strong> No STR license available</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 20px;">‚ö†Ô∏è</span>
                                <span style="font-size: 14px;"><strong>Competition:</strong> 85 active listings nearby</span>
                            </div>
                        </div>
                        
                        <!-- Recommendation -->
                        <div style="padding: 12px; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <svg width="20" height="20" fill="currentColor" style="color: var(--danger-red);" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                                </svg>
                                <strong style="color: var(--danger-red);">Not Recommended</strong>
                            </div>
                            <p style="font-size: 12px; color: var(--gray-700); margin-top: 8px;">
                                Legal restrictions make STR unfeasible for this property
                            </p>
                        </div>
                    </div>
                    
                    <!-- LTR Grade Panel -->
                    <div style="padding: 24px; background: var(--gray-50); border-radius: 12px; border: 2px solid var(--gray-200);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 class="h3">Long-Term Rental (LTR)</h3>
                            <div style="display: inline-block; padding: 8px 16px; background: linear-gradient(135deg, #10B981, #065F46); color: white; border-radius: 8px; font-size: 24px; font-weight: 700;">
                                A-
                            </div>
                        </div>
                        
                        <!-- Progress Bar -->
                        <div style="background: var(--gray-300); height: 12px; border-radius: 6px; margin-bottom: 20px; overflow: hidden;">
                            <div style="width: 88%; height: 100%; background: linear-gradient(90deg, #10B981, #34D399); border-radius: 6px;"></div>
                        </div>
                        
                        <!-- Key Factors -->
                        <div style="margin-bottom: 20px;">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                                <span style="font-size: 20px;">‚úÖ</span>
                                <span style="font-size: 14px;"><strong>Demand:</strong> High - 5% vacancy rate</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                                <span style="font-size: 20px;">‚úÖ</span>
                                <span style="font-size: 14px;"><strong>Cash Flow:</strong> +$1,200/month projected</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                                <span style="font-size: 20px;">‚úÖ</span>
                                <span style="font-size: 14px;"><strong>Location:</strong> Near subway & amenities</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 20px;">‚úÖ</span>
                                <span style="font-size: 14px;"><strong>Appreciation:</strong> 3.2% annual growth</span>
                            </div>
                        </div>
                        
                        <!-- Recommendation -->
                        <div style="padding: 12px; background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 8px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <svg width="20" height="20" fill="currentColor" style="color: var(--success-green);" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                </svg>
                                <strong style="color: var(--success-green);">Highly Recommended</strong>
                            </div>
                            <p style="font-size: 12px; color: var(--gray-700); margin-top: 8px;">
                                Excellent location with stable rental demand and positive returns
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Bottom Insight -->
                <div style="margin-top: 24px; padding: 16px; background: linear-gradient(to right, rgba(59, 130, 246, 0.05), rgba(16, 185, 129, 0.05)); border: 1px solid var(--gray-200); border-radius: 8px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <svg width="24" height="24" fill="currentColor" style="color: var(--primary-blue);" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        <div>
                            <strong style="font-size: 14px;">Key Insight:</strong>
                            <span style="font-size: 14px; color: var(--gray-700);">
                                While STR would generate higher returns ($11,044/mo vs $3,950/mo), legal restrictions make LTR your only viable option. 
                                The good news: strong fundamentals support a profitable long-term rental investment with steady appreciation.
                            </span>
                        </div>
                    </div>
                </div>
                
                <!-- Data Source Badge -->
                <div style="margin-top: 16px; text-align: center;">
                    <span class="data-source-badge ai-enhanced" style="font-size: 11px;">AI Analysis + Market Data</span>
                </div>
            </div>
            
            <!-- 2. Live Airbnb Comparables (moved to position #2) -->
            <section class="comparables-section" id="str-section">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h2 class="h2" style="display: inline-flex; align-items: center; gap: 12px;">
                                Live Airbnb Market Data
                                <span style="display: inline-flex; align-items: center; gap: 4px; color: var(--success-green); font-size: 14px; font-weight: 500;">
                                    <span style="font-size: 10px;">‚óè</span> 20 active listings found
                                </span>
                            </h2>
                            <p class="body" style="margin-top: 8px; color: var(--gray-600);">Similar properties in your area performing well on Airbnb</p>
                        </div>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span class="small" style="color: var(--gray-500);">Updated 3 minutes ago</span>
                            <span style="padding: 6px 12px; background: linear-gradient(135deg, #EF4444, #F59E0B); color: white; border-radius: 6px; font-size: 11px; font-weight: 700; text-transform: uppercase;">
                                ‚óè REAL MARKET DATA
                            </span>
                        </div>
                    </div>
                </div>
                
                <div class="comparables-grid" id="airbnb-comparables-container">
                    <!-- Comparable 1 -->
                    <a href="https://www.airbnb.com/rooms/123456" target="_blank" rel="noopener noreferrer" style="text-decoration: none; color: inherit;">
                        <div class="comparable-card">
                            <div style="position: relative;">
                                <img src="https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?w=600&h=400&fit=crop" 
                                     alt="Comparable 1" 
                                     class="comparable-image">
                                <div class="comparable-price">$209/night</div>
                                <span class="comparable-badge badge-top">Top Performer</span>
                            </div>
                            <div class="comparable-details">
                                <h3 class="comparable-title">Luxury 2BR Condo ‚Ä¢ King West</h3>
                                <div class="comparable-stats">
                                    <span class="comparable-stat comparable-rating">‚òÖ 4.92</span>
                                    <span class="comparable-stat">156 reviews</span>
                                    <span class="comparable-stat">85% booked</span>
                                </div>
                                <div class="comparable-revenue">
                                    <div>
                                        <div class="revenue-label">Monthly Revenue</div>
                                        <div class="revenue-value">$6,850</div>
                                    </div>
                                </div>
                                <div style="margin-top: 12px; text-align: center;">
                                    <span style="color: var(--primary-blue); font-size: 13px; font-weight: 500;">View on Airbnb ‚Üí</span>
                                </div>
                            </div>
                        </div>
                    </a>
                    
                    <!-- Comparable 2 -->
                    <a href="https://www.airbnb.com/rooms/789012" target="_blank" rel="noopener noreferrer" style="text-decoration: none; color: inherit;">
                        <div class="comparable-card">
                            <div style="position: relative;">
                                <img src="https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=600&h=400&fit=crop" 
                                     alt="Comparable 2" 
                                     class="comparable-image">
                                <div class="comparable-price">$175/night</div>
                                <span class="comparable-badge badge-similar">Most Similar</span>
                            </div>
                            <div class="comparable-details">
                                <h3 class="comparable-title">Modern 1BR+Den ‚Ä¢ Liberty Village</h3>
                                <div class="comparable-stats">
                                    <span class="comparable-stat comparable-rating">‚òÖ 4.85</span>
                                    <span class="comparable-stat">89 reviews</span>
                                    <span class="comparable-stat">78% booked</span>
                                </div>
                                <div class="comparable-revenue">
                                    <div>
                                        <div class="revenue-label">Monthly Revenue</div>
                                        <div class="revenue-value">$5,100</div>
                                    </div>
                                </div>
                                <div style="margin-top: 12px; text-align: center;">
                                    <span style="color: var(--primary-blue); font-size: 13px; font-weight: 500;">View on Airbnb ‚Üí</span>
                                </div>
                            </div>
                        </div>
                    </a>
                    
                    <!-- Comparable 3 -->
                    <a href="https://www.airbnb.com/rooms/345678" target="_blank" rel="noopener noreferrer" style="text-decoration: none; color: inherit;">
                        <div class="comparable-card">
                            <div style="position: relative;">
                                <img src="https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?w=600&h=400&fit=crop" 
                                     alt="Comparable 3" 
                                     class="comparable-image">
                                <div class="comparable-price">$165/night</div>
                                <span class="comparable-badge badge-value">Best Value</span>
                            </div>
                            <div class="comparable-details">
                                <h3 class="comparable-title">Cozy 1BR ‚Ä¢ Entertainment District</h3>
                                <div class="comparable-stats">
                                    <span class="comparable-stat comparable-rating">‚òÖ 4.78</span>
                                    <span class="comparable-stat">234 reviews</span>
                                    <span class="comparable-stat">82% booked</span>
                                </div>
                                <div class="comparable-revenue">
                                    <div>
                                        <div class="revenue-label">Monthly Revenue</div>
                                        <div class="revenue-value">$4,950</div>
                                    </div>
                                </div>
                                <div style="margin-top: 12px; text-align: center;">
                                    <span style="color: var(--primary-blue); font-size: 13px; font-weight: 500;">View on Airbnb ‚Üí</span>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
                
                <!-- View All Button -->
                <div style="text-align: center; margin-top: 24px;">
                    <button onclick="alert('In the live application, this would expand to show all 20 comparable listings or navigate to a detailed comparables page.');" 
                            style="padding: 10px 24px; background: white; border: 1px solid var(--gray-300); border-radius: 8px; color: var(--gray-700); font-weight: 500; cursor: pointer; transition: all 0.2s; hover: background: var(--gray-50);"
                            onmouseover="this.style.background='#F3F4F6'; this.style.borderColor='#9CA3AF';" 
                            onmouseout="this.style.background='white'; this.style.borderColor='#D1D5DB';">
                        View All Comparable Listings <span style="color: var(--gray-500); font-size: 12px;">(20 total)</span>
                    </button>
                </div>
            </section>
            
            <!-- 3. Airbnb Market Statistics -->
            <div class="card">
                <h2 class="h2" style="margin-bottom: 20px;">Airbnb Market Statistics <span class="data-source-badge live-api">Airbnb API</span></h2>
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 24px; text-align: center;">
                    <div>
                        <div class="h1" style="color: var(--gray-900);" id="str-daily-rate">$447</div>
                        <div class="small">Average nightly rate</div>
                    </div>
                    <div>
                        <div class="h1" style="color: var(--primary-blue);">70%</div>
                        <div class="small">Average occupancy</div>
                    </div>
                    <div>
                        <div class="small" style="margin-bottom: 4px;">Projected Advantage</div>
                        <div class="h1" style="color: var(--success-green);">+$6,369/mo</div>
                        <div style="font-size: 12px; color: var(--gray-500);">over long-term rental</div>
                    </div>
                    <div>
                        <div class="h1" style="color: var(--gray-900);">4.5‚òÖ</div>
                        <div class="small">Average rating</div>
                    </div>
                </div>
            </div>
            
            <!-- 4. STR Revenue Calculator -->
            <section class="calculator-section">
                <div class="card">
                    <h2 class="h3" style="margin-bottom: 20px;">
                        STR Revenue Calculator
                        <span class="info-icon" title="Adjust values to see revenue projections">?</span>
                    </h2>
                    <div class="calculator-inputs">
                        <div class="input-group">
                            <label class="input-label">Nightly Rate</label>
                            <input type="range" class="input-slider" id="nightlyRate" min="50" max="500" value="185" oninput="window.updateSimpleCalculator()">
                            <span class="input-value" id="nightlyRateValue">$185/night</span>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Occupancy Rate</label>
                            <input type="range" class="input-slider" id="occupancyRate" min="0" max="100" value="78" oninput="window.updateSimpleCalculator()">
                            <span class="input-value" id="occupancyRateValue">78%</span>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Cleaning Fee</label>
                            <input type="range" class="input-slider" id="cleaningFee" min="0" max="200" value="75" oninput="window.updateSimpleCalculator()">
                            <span class="input-value" id="cleaningFeeValue">$75</span>
                        </div>
                    </div>
                </div>
                
                <div class="calculator-results">
                    <h3 class="result-title">Projected Monthly Revenue</h3>
                    <div class="result-value" id="monthlyRevenueResult">$5,240</div>
                    <p class="result-subtitle" id="nightsBookedText">Based on 23 nights booked per month</p>
                    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--gray-200);">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                            <span class="small">Annual Revenue</span>
                            <span class="h3" style="color: var(--success-green);" id="str-annual-revenue">$62,880</span>
                            <!-- Hidden element for backward compatibility -->
                            <span id="annualRevenueCalc" style="display: none;">$62,880</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span class="small">vs. Long-term Rental</span>
                            <span class="h3" style="color: var(--success-green);" id="vsLTRCalc">+68%</span>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- 5. Cash Flow Comparison -->
            <section class="cashflow-comparison">
                <div class="cashflow-card str">
                    <div class="cashflow-header">
                        <h3 class="cashflow-title">
                            <svg width="20" height="20" fill="currentColor" style="color: var(--success-green);">
                                <path d="M10 2a8 8 0 100 16 8 8 0 000-16z"/>
                            </svg>
                            Short-Term Rental
                        </h3>
                        <span class="cashflow-badge badge-recommended">Recommended</span>
                    </div>
                    <div class="cashflow-breakdown">
                        <div class="cashflow-item">
                            <span class="cashflow-label">Monthly Revenue</span>
                            <span class="cashflow-value positive" id="strRevenueCard">+$11,044</span>
                        </div>
                        <div class="cashflow-item">
                            <span class="cashflow-label">Mortgage Payment</span>
                            <span class="cashflow-value negative" id="strMortgageCard">-$4,269</span>
                        </div>
                        <div class="cashflow-item">
                            <span class="cashflow-label">Operating Expenses</span>
                            <span class="cashflow-value negative" id="strExpensesCard">-$2,761</span>
                        </div>
                        <div class="cashflow-item">
                            <span class="cashflow-label">Net Cash Flow</span>
                            <span class="cashflow-value cashflow-total positive" id="strCashFlowCard">+$4,014</span>
                        </div>
                    </div>
                </div>
                
                <div class="cashflow-card ltr">
                    <div class="cashflow-header">
                        <h3 class="cashflow-title">
                            <svg width="20" height="20" fill="currentColor" style="color: var(--gray-500);">
                                <path d="M10 2a8 8 0 100 16 8 8 0 000-16z"/>
                            </svg>
                            Long-Term Rental
                        </h3>
                    </div>
                    <div class="cashflow-breakdown">
                        <div class="cashflow-item">
                            <span class="cashflow-label">Monthly Rent</span>
                            <span class="cashflow-value positive" id="ltrRentCard">+$4,000</span>
                        </div>
                        <div class="cashflow-item">
                            <span class="cashflow-label">Mortgage Payment</span>
                            <span class="cashflow-value negative" id="ltrMortgageCard">-$4,269</span>
                        </div>
                        <div class="cashflow-item">
                            <span class="cashflow-label">Operating Expenses</span>
                            <span class="cashflow-value negative">-$200</span>
                        </div>
                        <div class="cashflow-item">
                            <span class="cashflow-label">Net Cash Flow</span>
                            <span class="cashflow-value cashflow-total negative" id="ltrCashFlowCard">-$469</span>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- STR Operating Expenses Breakdown (NEWLY ADDED) -->
            <section class="card" style="position: relative; margin-top: 24px;">
                <span class="newly-added-badge">Newly Added</span>
                <h2 class="h2" style="margin-bottom: 20px;">STR Operating Expenses Breakdown <span class="data-source-badge calculated">Calculated</span></h2>
                <p style="color: var(--gray-600); margin-bottom: 24px;">Monthly expenses specific to short-term rental operation</p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                    <!-- Revenue-Based Expenses -->
                    <div>
                        <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">Revenue-Based Expenses</h3>
                        <div style="background: var(--gray-50); padding: 16px; border-radius: 8px;">
                            <p style="font-size: 13px; color: var(--gray-600); margin-bottom: 12px;">Based on $11,044 monthly revenue</p>
                            <div style="space-y: 8px;">
                                <div style="display: flex; justify-content: space-between; padding: 10px; background: white; border-radius: 6px; margin-bottom: 6px;">
                                    <span style="font-size: 14px;">Management Fee (20%)</span>
                                    <span style="font-size: 14px; font-weight: 600;">$2,209/mo</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 10px; background: white; border-radius: 6px; margin-bottom: 6px;">
                                    <span style="font-size: 14px;">Cleaning (10%)</span>
                                    <span style="font-size: 14px; font-weight: 600;">$1,104/mo</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 10px; background: white; border-radius: 6px; margin-bottom: 6px;">
                                    <span style="font-size: 14px;">Platform Fees (3%)</span>
                                    <span style="font-size: 14px; font-weight: 600;">$331/mo</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 10px; background: white; border-radius: 6px; margin-bottom: 6px;">
                                    <span style="font-size: 14px;">Supplies & Amenities (3%)</span>
                                    <span style="font-size: 14px; font-weight: 600;">$331/mo</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 10px; background: white; border-radius: 6px;">
                                    <span style="font-size: 14px;">Marketing (2%)</span>
                                    <span style="font-size: 14px; font-weight: 600;">$221/mo</span>
                                </div>
                            </div>
                            <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--gray-300);">
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="font-size: 14px; font-weight: 600;">Subtotal (38%)</span>
                                    <span style="font-size: 14px; font-weight: 700; color: var(--error-red);">$4,196/mo</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Fixed Expenses -->
                    <div>
                        <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">Fixed STR Expenses</h3>
                        <div style="background: var(--gray-50); padding: 16px; border-radius: 8px;">
                            <p style="font-size: 13px; color: var(--gray-600); margin-bottom: 12px;">Owner-paid utilities & services</p>
                            <div style="space-y: 8px;">
                                <div style="display: flex; justify-content: space-between; padding: 10px; background: white; border-radius: 6px; margin-bottom: 6px;">
                                    <span style="font-size: 14px;">Utilities (100% paid)</span>
                                    <span style="font-size: 14px; font-weight: 600;">$350/mo</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 10px; background: white; border-radius: 6px; margin-bottom: 6px;">
                                    <span style="font-size: 14px;">STR Insurance</span>
                                    <span style="font-size: 14px; font-weight: 600;">$250/mo</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 10px; background: white; border-radius: 6px; margin-bottom: 6px;">
                                    <span style="font-size: 14px;">Internet & Cable</span>
                                    <span style="font-size: 14px; font-weight: 600;">$150/mo</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 10px; background: white; border-radius: 6px; margin-bottom: 6px;">
                                    <span style="font-size: 14px;">Maintenance Reserve</span>
                                    <span style="font-size: 14px; font-weight: 600;">$200/mo</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 10px; background: white; border-radius: 6px;">
                                    <span style="font-size: 14px;">License & Permits</span>
                                    <span style="font-size: 14px; font-weight: 600;">$50/mo</span>
                                </div>
                            </div>
                            <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--gray-300);">
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="font-size: 14px; font-weight: 600;">Subtotal</span>
                                    <span style="font-size: 14px; font-weight: 700; color: var(--error-red);">$1,000/mo</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Total STR Expenses Summary -->
                <div style="background: linear-gradient(135deg, #fef3c7, #fed7aa); padding: 16px; border-radius: 8px; margin-top: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; text-align: center;">
                        <div>
                            <p style="font-size: 13px; color: var(--gray-700); margin-bottom: 4px;">Gross Revenue</p>
                            <p style="font-size: 20px; font-weight: 700; color: var(--success-green);">$11,044/mo</p>
                        </div>
                        <div>
                            <p style="font-size: 13px; color: var(--gray-700); margin-bottom: 4px;">Total STR Expenses</p>
                            <p style="font-size: 20px; font-weight: 700; color: var(--error-red);">$5,196/mo</p>
                        </div>
                        <div>
                            <p style="font-size: 13px; color: var(--gray-700); margin-bottom: 4px;">Net Operating Income</p>
                            <p style="font-size: 20px; font-weight: 700; color: var(--primary-blue);">$5,848/mo</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- STR Regulations & Compliance (NEWLY ADDED) -->
            <section class="card" style="position: relative; margin-top: 24px;">
                <span class="newly-added-badge">Newly Added</span>
                <h2 class="h2" style="margin-bottom: 20px;">STR Regulations & Compliance <span class="data-source-badge ai-enhanced">AI Research</span></h2>
                <p style="color: var(--gray-600); margin-bottom: 24px;">Short-term rental rules and requirements for Toronto</p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                    <!-- License Requirements -->
                    <div>
                        <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">License Requirements</h3>
                        <div style="background: linear-gradient(135deg, #fee2e2, #fecaca); padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <span style="font-size: 20px;">‚ö†Ô∏è</span>
                                <span style="font-size: 15px; font-weight: 600; color: var(--error-red);">Primary Residence Only</span>
                            </div>
                            <p style="font-size: 13px; color: var(--gray-700); margin: 0;">
                                STR only allowed in your primary residence where you live majority of the year
                            </p>
                        </div>
                        
                        <div style="background: var(--gray-50); padding: 16px; border-radius: 8px;">
                            <p style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">Required Licenses:</p>
                            <ul style="list-style: none; padding: 0; margin: 0;">
                                <li style="display: flex; align-items: start; gap: 8px; margin-bottom: 8px;">
                                    <span style="color: var(--primary-blue);">‚úì</span>
                                    <span style="font-size: 13px;">Municipal STR License ($50/year)</span>
                                </li>
                                <li style="display: flex; align-items: start; gap: 8px; margin-bottom: 8px;">
                                    <span style="color: var(--primary-blue);">‚úì</span>
                                    <span style="font-size: 13px;">Business Registration Number</span>
                                </li>
                                <li style="display: flex; align-items: start; gap: 8px; margin-bottom: 8px;">
                                    <span style="color: var(--primary-blue);">‚úì</span>
                                    <span style="font-size: 13px;">Municipal Accommodation Tax (4%)</span>
                                </li>
                                <li style="display: flex; align-items: start; gap: 8px;">
                                    <span style="color: var(--primary-blue);">‚úì</span>
                                    <span style="font-size: 13px;">Display license # in all listings</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Operating Restrictions -->
                    <div>
                        <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">Operating Restrictions</h3>
                        <div style="background: var(--primary-blue); background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                            <p style="font-size: 14px; margin-bottom: 8px;">Maximum Rental Days</p>
                            <p style="font-size: 32px; font-weight: 700; margin: 0;">180 days/year</p>
                            <p style="font-size: 12px; margin-top: 8px; opacity: 0.9;">Entire home rentals when you're away</p>
                        </div>
                        
                        <div style="background: var(--gray-50); padding: 16px; border-radius: 8px;">
                            <p style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">Key Restrictions:</p>
                            <ul style="list-style: none; padding: 0; margin: 0;">
                                <li style="display: flex; align-items: start; gap: 8px; margin-bottom: 8px;">
                                    <span style="color: var(--warning-yellow);">‚ö°</span>
                                    <span style="font-size: 13px;">Max 3 bedrooms for rent</span>
                                </li>
                                <li style="display: flex; align-items: start; gap: 8px; margin-bottom: 8px;">
                                    <span style="color: var(--warning-yellow);">‚ö°</span>
                                    <span style="font-size: 13px;">No rentals < 28 days in secondary suites</span>
                                </li>
                                <li style="display: flex; align-items: start; gap: 8px; margin-bottom: 8px;">
                                    <span style="color: var(--warning-yellow);">‚ö°</span>
                                    <span style="font-size: 13px;">Must maintain rental records</span>
                                </li>
                                <li style="display: flex; align-items: start; gap: 8px;">
                                    <span style="color: var(--warning-yellow);">‚ö°</span>
                                    <span style="font-size: 13px;">Subject to building/condo rules</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Compliance Risk Assessment -->
                <div style="background: #fef3c7; padding: 16px; border-radius: 8px; margin-top: 20px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 24px;">‚öñÔ∏è</span>
                        <div>
                            <p style="font-size: 14px; font-weight: 600; margin: 0; margin-bottom: 4px;">Compliance Risk: HIGH</p>
                            <p style="font-size: 13px; color: var(--gray-700); margin: 0;">
                                Investment properties cannot be used for STR in Toronto. Consider this property only if it will be your primary residence, or explore other municipalities with less restrictive STR regulations.
                            </p>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- 6. Financial Analysis Calculator -->
            <section class="financial-calculator-section" id="financial-calculator-section">
                <div class="card">
                    <h2 class="h2" style="margin-bottom: 24px;">Financial Analysis Calculator <span class="data-source-badge user-input">User Input</span></h2>
                    
                    <!-- Data Freshness and Actions Bar -->
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--gray-50); border-radius: 8px; margin-bottom: 20px;">
                        <div style="display: flex; align-items: center; gap: 16px;">
                            <span style="font-size: 12px; color: var(--gray-600);">üìä Data updated: <strong>2 minutes ago</strong></span>
                            <button style="padding: 4px 12px; background: white; border: 1px solid var(--gray-300); border-radius: 4px; font-size: 12px; cursor: pointer;">üîÑ Refresh Rates</button>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button onclick="saveScenario()" style="padding: 6px 16px; background: var(--primary-blue); color: white; border: none; border-radius: 6px; font-size: 13px; font-weight: 500; cursor: pointer;">üíæ Save Scenario</button>
                            <button onclick="exportToExcel()" style="padding: 6px 16px; background: var(--success-green); color: white; border: none; border-radius: 6px; font-size: 13px; font-weight: 500; cursor: pointer;">üìä Export to Excel</button>
                        </div>
                    </div>
                    
                    <!-- Saved Scenarios Bar -->
                    <div id="savedScenarios" style="display: none; margin-bottom: 20px; padding: 12px; background: #fef3c7; border: 1px solid #fbbf24; border-radius: 8px;">
                        <div style="font-size: 13px; font-weight: 600; margin-bottom: 8px;">üìå Saved Scenarios:</div>
                        <div id="scenarioButtons" style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <button class="scenario-btn active" onclick="loadPresetScenario('conservative')" style="padding: 4px 12px; background: white; border: 1px solid #f59e0b; border-radius: 4px; font-size: 12px; cursor: pointer;">Conservative (50% occ)</button>
                            <button class="scenario-btn" onclick="loadPresetScenario('optimistic')" style="padding: 4px 12px; background: white; border: 1px solid #d1d5db; border-radius: 4px; font-size: 12px; cursor: pointer;">Optimistic (85% occ)</button>
                            <button class="scenario-btn" onclick="loadPresetScenario('market')" style="padding: 4px 12px; background: white; border: 1px solid #d1d5db; border-radius: 4px; font-size: 12px; cursor: pointer;">Market Average</button>
                        </div>
                    </div>
                    
                    <!-- Two Column Layout -->
                    <div style="display: grid; grid-template-columns: 1fr 1.2fr; gap: 32px;">
                        <!-- Left Column: Cash Flow Chart -->
                        <div style="background: var(--gray-50); border-radius: 12px; padding: 20px;">
                            <h3 class="h3" style="margin-bottom: 16px;">Monthly Cash Flow Comparison</h3>
                            <div style="position: relative; height: 300px; background: white; border-radius: 8px; padding: 20px;">
                                <!-- Bar Chart Visualization -->
                                <svg viewBox="0 0 400 280" style="width: 100%; height: 100%;">
                                    <!-- Grid lines -->
                                    <line x1="60" y1="30" x2="340" y2="30" stroke="#E5E7EB" stroke-width="1" stroke-dasharray="2,2"/>
                                    <line x1="60" y1="80" x2="340" y2="80" stroke="#E5E7EB" stroke-width="1" stroke-dasharray="2,2"/>
                                    <line x1="60" y1="130" x2="340" y2="130" stroke="#E5E7EB" stroke-width="1" stroke-dasharray="2,2"/>
                                    <line x1="60" y1="180" x2="340" y2="180" stroke="#E5E7EB" stroke-width="1" stroke-dasharray="2,2"/>
                                    <line x1="60" y1="230" x2="340" y2="230" stroke="#E5E7EB" stroke-width="1" stroke-dasharray="2,2"/>
                                    
                                    <!-- STR Bar -->
                                    <rect id="strBar" x="80" y="50" width="80" height="180" fill="#10b981" rx="4"/>
                                    <text x="120" y="250" text-anchor="middle" font-size="14" font-weight="600" fill="#374151">STR</text>
                                    <text id="strBarValue" x="120" y="40" text-anchor="middle" font-size="16" font-weight="700" fill="#10b981">$8,500</text>
                                    
                                    <!-- LTR Bar -->
                                    <rect id="ltrBar" x="240" y="150" width="80" height="80" fill="#6b7280" rx="4"/>
                                    <text x="280" y="250" text-anchor="middle" font-size="14" font-weight="600" fill="#374151">LTR</text>
                                    <text id="ltrBarValue" x="280" y="140" text-anchor="middle" font-size="16" font-weight="700" fill="#6b7280">$1,500</text>
                                    
                                    <!-- Y-axis -->
                                    <line x1="60" y1="230" x2="60" y2="30" stroke="#374151" stroke-width="2"/>
                                    <text x="45" y="235" text-anchor="end" font-size="11" fill="#6B7280">$0</text>
                                    <text x="45" y="185" text-anchor="end" font-size="11" fill="#6B7280">$2.5k</text>
                                    <text x="45" y="135" text-anchor="end" font-size="11" fill="#6B7280">$5k</text>
                                    <text x="45" y="85" text-anchor="end" font-size="11" fill="#6B7280">$7.5k</text>
                                    <text x="45" y="35" text-anchor="end" font-size="11" fill="#6B7280">$10k</text>
                                    
                                    <!-- X-axis -->
                                    <line x1="60" y1="230" x2="340" y2="230" stroke="#374151" stroke-width="2"/>
                                </svg>
                            </div>
                            
                            <!-- Key Metrics Below Chart -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 20px;">
                                <div style="background: white; padding: 12px; border-radius: 8px;">
                                    <div class="small" style="color: var(--gray-600);">STR Advantage</div>
                                    <div class="h3" style="color: var(--success-green);" id="strAdvantage">+$7,000/mo</div>
                                </div>
                                <div style="background: white; padding: 12px; border-radius: 8px;">
                                    <div class="small" style="color: var(--gray-600);">Annual Difference</div>
                                    <div class="h3" style="color: var(--success-green);" id="annualDifference">+$84,000/yr</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Right Column: Adjustable Assumptions -->
                        <div style="background: white; border: 1px solid var(--gray-200); border-radius: 12px; padding: 20px;">
                            <h3 class="h3" style="margin-bottom: 20px;">
                                Financial Assumptions 
                                <span class="info-icon" title="Adjust these values to see how changes affect your returns">?</span>
                            </h3>
                            
                            <div style="display: flex; flex-direction: column; gap: 24px;">
                                <!-- Revenue Assumptions -->
                                <div>
                                    <h4 style="font-size: 14px; font-weight: 600; color: var(--gray-700); margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid var(--gray-200);">
                                        üìä Revenue Assumptions
                                    </h4>
                                    
                                    <div style="display: flex; flex-direction: column; gap: 16px;">
                                        <div>
                                            <label class="small" style="display: block; margin-bottom: 4px;">STR Nightly Rate</label>
                                            <div style="display: flex; align-items: center; gap: 12px;">
                                                <input type="range" id="strNightlySlider" min="100" max="600" value="363" style="flex: 1;" oninput="document.getElementById('strNightlyValue').textContent = '$' + this.value; updateFinancialCalculator();">
                                                <span id="strNightlyValue" style="min-width: 60px; text-align: right; font-weight: 600;">$363</span>
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <label class="small" style="display: block; margin-bottom: 4px;">STR Occupancy Rate</label>
                                            <div style="display: flex; align-items: center; gap: 12px;">
                                                <input type="range" id="strOccupancySlider" min="40" max="95" value="75" style="flex: 1;" oninput="document.getElementById('strOccupancyValue').textContent = this.value + '%'; updateFinancialCalculator();">
                                                <span id="strOccupancyValue" style="min-width: 40px; text-align: right; font-weight: 600;">75%</span>
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <label class="small" style="display: block; margin-bottom: 4px;">Long-term Monthly Rent</label>
                                            <div style="display: flex; align-items: center; gap: 12px;">
                                                <input type="range" id="ltrRentSlider" min="2000" max="8000" value="4000" style="flex: 1;" oninput="document.getElementById('ltrRentValue').textContent = '$' + parseInt(this.value).toLocaleString(); updateFinancialCalculator();">
                                                <span id="ltrRentValue" style="min-width: 70px; text-align: right; font-weight: 600;">$4,000</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Expense Assumptions -->
                                <div>
                                    <h4 style="font-size: 14px; font-weight: 600; color: var(--gray-700); margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid var(--gray-200);">
                                        üí∞ Operating Expenses
                                    </h4>
                                    
                                    <div style="display: flex; flex-direction: column; gap: 16px;">
                                        <div>
                                            <label class="small" style="display: block; margin-bottom: 4px;">
                                                Property Tax
                                                <span style="color: var(--success-green); font-size: 11px;">‚úì Verified from Toronto.ca</span>
                                            </label>
                                            <div style="display: flex; align-items: center; gap: 12px;">
                                                <input type="number" id="propertyTaxInput" value="458" step="1" style="flex: 1; padding: 6px; border: 1px solid var(--gray-300); border-radius: 4px;" oninput="document.getElementById('propertyTaxMonthly').textContent = '$' + Math.round(this.value) + '/mo'; document.getElementById('propertyTaxAnnual').textContent = '$' + (Math.round(this.value * 12)).toLocaleString() + '/year'; if(typeof updateFinancialCalculator !== 'undefined') updateFinancialCalculator();">
                                                <span id="propertyTaxMonthly" style="min-width: 70px; text-align: right; font-weight: 600;">$458/mo</span>
                                            </div>
                                            <div style="font-size: 11px; color: var(--gray-500); margin-top: 4px;">Annual: <span id="propertyTaxAnnual" style="font-weight: 600;">$5,490/year</span></div>
                                        </div>
                                        
                                        <div>
                                            <label class="small" style="display: block; margin-bottom: 4px;">
                                                Insurance Estimate
                                                <span style="color: var(--warning-yellow); font-size: 11px;">‚ö† Based on 3 quotes</span>
                                            </label>
                                            <div style="display: flex; align-items: center; gap: 12px;">
                                                <input type="range" id="insuranceSlider" min="100" max="500" value="250" style="flex: 1;" oninput="document.getElementById('insuranceValue').textContent = '$' + this.value + '/mo'; if(typeof updateFinancialCalculator !== 'undefined') updateFinancialCalculator();">
                                                <span id="insuranceValue" style="min-width: 70px; text-align: right; font-weight: 600;">$250/mo</span>
                                            </div>
                                            <div style="font-size: 11px; color: var(--gray-500); margin-top: 4px;">Sources: TD Insurance, Intact, Desjardins</div>
                                        </div>
                                        
                                        <div>
                                            <label class="small" style="display: block; margin-bottom: 4px;">Property Management Fee</label>
                                            <div style="display: flex; align-items: center; gap: 12px;">
                                                <input type="range" id="mgmtFeeSlider" min="0" max="30" value="25" style="flex: 1;" oninput="document.getElementById('mgmtFeeValue').textContent = this.value + '%'; updateFinancialCalculator();">
                                                <span id="mgmtFeeValue" style="min-width: 40px; text-align: right; font-weight: 600;">25%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Financing Toggle and Options -->
                                <div>
                                    <div class="toggle-container">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="financingToggle" checked>
                                            <span class="toggle-slider"></span>
                                        </label>
                                        <span class="toggle-label">Include Financing (uncheck for cash purchase)</span>
                                    </div>
                                    
                                    <div id="financingSection" class="financing-section">
                                        <h4 style="font-size: 14px; font-weight: 600; color: var(--gray-700); margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid var(--gray-200);">
                                            üè¶ Financing Assumptions
                                        </h4>
                                        
                                        <!-- Current Mortgage Rates -->
                                        <div style="padding: 12px; background: #e0f2fe; border-radius: 8px; margin-bottom: 16px;">
                                            <div style="font-size: 12px; font-weight: 600; margin-bottom: 8px;">Current Mortgage Rates (5-yr fixed)</div>
                                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; font-size: 11px;">
                                                <div>RBC: <strong>6.14%</strong></div>
                                                <div>TD: <strong>6.20%</strong></div>
                                                <div>Scotia: <strong>6.09%</strong></div>
                                            </div>
                                            <div style="font-size: 10px; color: var(--gray-600); margin-top: 6px;">Updated: Jan 10, 2025</div>
                                        </div>
                                        
                                        <div style="display: flex; flex-direction: column; gap: 16px;">
                                            <div>
                                                <label class="small" style="display: block; margin-bottom: 4px;">Down Payment</label>
                                                <div style="display: flex; align-items: center; gap: 12px;">
                                                    <input type="range" id="downPaymentSlider" min="5" max="100" value="20" style="flex: 1;" oninput="document.getElementById('downPaymentValue').textContent = this.value + '%'; document.getElementById('downPaymentAmount').textContent = '$' + ((window.propertyPrice || 849900) * this.value / 100).toLocaleString(); updateFinancialCalculator();">
                                                    <span id="downPaymentValue" style="min-width: 40px; text-align: right; font-weight: 600;">20%</span>
                                                </div>
                                                <div class="small" style="margin-top: 4px;">Amount: <span id="downPaymentAmount" style="font-weight: 600;">$169,980</span></div>
                                            </div>
                                            
                                            <div>
                                                <label class="small" style="display: block; margin-bottom: 4px;">Interest Rate</label>
                                                <div style="display: flex; align-items: center; gap: 12px;">
                                                    <input type="range" id="interestRateSlider" min="3" max="8" value="6.5" step="0.1" style="flex: 1;" oninput="document.getElementById('interestRateValue').textContent = this.value + '%'; updateFinancialCalculator();">
                                                    <span id="interestRateValue" style="min-width: 50px; text-align: right; font-weight: 600;">6.5%</span>
                                                </div>
                                            </div>
                                            
                                            <div>
                                                <label class="small" style="display: block; margin-bottom: 4px;">Loan Term</label>
                                                <div style="display: flex; align-items: center; gap: 12px;">
                                                    <input type="range" id="loanTermSlider" min="1" max="30" value="30" step="1" style="flex: 1;" oninput="document.getElementById('loanTermValue').textContent = this.value + ' years'; updateFinancialCalculator();">
                                                    <span id="loanTermValue" style="min-width: 60px; text-align: right; font-weight: 600;">30 years</span>
                                                </div>
                                            </div>
                                            
                                            <div style="padding: 12px; background: var(--gray-50); border-radius: 8px;">
                                                <div class="small" style="color: var(--gray-600);">Monthly Mortgage Payment</div>
                                                <div class="h2" style="color: var(--danger-red);" id="mortgagePayment">-$4,269</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Action Buttons -->
                                <div style="display: flex; gap: 12px; padding-top: 12px; border-top: 1px solid var(--gray-200);">
                                    <button id="resetBtn" style="flex: 1; padding: 10px; background: var(--gray-100); color: var(--gray-700); border: 1px solid var(--gray-300); border-radius: 8px; font-weight: 500; cursor: pointer;">
                                        Reset to Defaults
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Summary Metrics Bar -->
                    <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 16px; margin-top: 24px; padding: 20px; background: linear-gradient(to right, var(--gray-50), white); border-radius: 12px;">
                        <div style="text-align: center;">
                            <div class="small" style="color: var(--gray-600); margin-bottom: 4px;">STR Revenue</div>
                            <div class="h3" style="color: var(--gray-900);" id="strRevenueSum">$132,000/yr</div>
                        </div>
                        <div style="text-align: center;">
                            <div class="small" style="color: var(--gray-600); margin-bottom: 4px;">Total Expenses</div>
                            <div class="h3" style="color: var(--danger-red);" id="totalExpensesSum">-$30,000/yr</div>
                        </div>
                        <div style="text-align: center;">
                            <div class="small" style="color: var(--gray-600); margin-bottom: 4px;">Net Income</div>
                            <div class="h3" style="color: var(--success-green);" id="netIncomeSum">$102,000/yr</div>
                        </div>
                        <div style="text-align: center;">
                            <div class="small" style="color: var(--gray-600); margin-bottom: 4px;">Cash-on-Cash</div>
                            <div class="h3" style="color: var(--primary-blue);" id="cashOnCash">60.0%</div>
                        </div>
                        <div style="text-align: center;">
                            <div class="small" style="color: var(--gray-600); margin-bottom: 4px;">Cap Rate</div>
                            <div class="h3" style="color: var(--primary-blue);" id="capRate">12.0%</div>
                        </div>
                    </div>
                </div>
                
                <!-- Down Payment Comparison -->
                <div class="card" style="margin-top: 24px;">
                    <h3 class="h3" style="margin-bottom: 20px;">Mortgage Comparison by Down Payment</h3>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px;">
                        <div style="padding: 16px; background: var(--gray-50); border-radius: 8px; border: 2px solid transparent;" id="dp20">
                            <div style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">20% Down</div>
                            <div style="font-size: 12px; color: var(--gray-600); margin-bottom: 4px;">Down: $169,980</div>
                            <div style="font-size: 12px; color: var(--gray-600); margin-bottom: 4px;">Loan: $679,920</div>
                            <div style="font-size: 14px; font-weight: 700; color: var(--danger-red);">Payment: $4,269/mo</div>
                            <div style="font-size: 11px; color: var(--gray-500); margin-top: 4px;">Total Interest: $857,960</div>
                        </div>
                        <div style="padding: 16px; background: #e0f2fe; border-radius: 8px; border: 2px solid var(--primary-blue);" id="dp25">
                            <div style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">25% Down ‚≠ê</div>
                            <div style="font-size: 12px; color: var(--gray-600); margin-bottom: 4px;">Down: $212,475</div>
                            <div style="font-size: 12px; color: var(--gray-600); margin-bottom: 4px;">Loan: $637,425</div>
                            <div style="font-size: 14px; font-weight: 700; color: var(--primary-blue);">Payment: $4,002/mo</div>
                            <div style="font-size: 11px; color: var(--gray-500); margin-top: 4px;">Total Interest: $804,295</div>
                            <div style="font-size: 11px; color: var(--success-green); margin-top: 4px; font-weight: 600;">Save $267/mo</div>
                        </div>
                        <div style="padding: 16px; background: var(--gray-50); border-radius: 8px; border: 2px solid transparent;" id="dp30">
                            <div style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">30% Down</div>
                            <div style="font-size: 12px; color: var(--gray-600); margin-bottom: 4px;">Down: $254,970</div>
                            <div style="font-size: 12px; color: var(--gray-600); margin-bottom: 4px;">Loan: $594,930</div>
                            <div style="font-size: 14px; font-weight: 700; color: var(--success-green);">Payment: $3,735/mo</div>
                            <div style="font-size: 11px; color: var(--gray-500); margin-top: 4px;">Total Interest: $750,630</div>
                            <div style="font-size: 11px; color: var(--success-green); margin-top: 4px; font-weight: 600;">Save $534/mo</div>
                        </div>
                        <div style="padding: 16px; background: var(--gray-50); border-radius: 8px; border: 2px solid transparent;" id="dp35">
                            <div style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">35% Down</div>
                            <div style="font-size: 12px; color: var(--gray-600); margin-bottom: 4px;">Down: $297,465</div>
                            <div style="font-size: 12px; color: var(--gray-600); margin-bottom: 4px;">Loan: $552,435</div>
                            <div style="font-size: 14px; font-weight: 700; color: var(--success-green);">Payment: $3,469/mo</div>
                            <div style="font-size: 11px; color: var(--gray-500); margin-top: 4px;">Total Interest: $696,965</div>
                            <div style="font-size: 11px; color: var(--success-green); margin-top: 4px; font-weight: 600;">Save $800/mo</div>
                        </div>
                    </div>
                </div>
                
                <!-- Break-even Analysis -->
                <div class="card" style="margin-top: 24px;">
                    <h3 class="h3" style="margin-bottom: 20px;">Break-even Analysis</h3>
                    <div style="display: grid; grid-template-columns: 1.5fr 1fr; gap: 24px;">
                        <div>
                            <!-- Break-even Chart -->
                            <div style="position: relative; height: 250px; background: var(--gray-50); border-radius: 8px; padding: 20px;">
                                <svg viewBox="0 0 500 220" style="width: 100%; height: 100%;">
                                    <!-- Grid -->
                                    <line x1="40" y1="180" x2="460" y2="180" stroke="#d1d5db" stroke-width="1"/>
                                    <line x1="40" y1="140" x2="460" y2="140" stroke="#d1d5db" stroke-width="1" stroke-dasharray="2,2"/>
                                    <line x1="40" y1="100" x2="460" y2="100" stroke="#d1d5db" stroke-width="1" stroke-dasharray="2,2"/>
                                    <line x1="40" y1="60" x2="460" y2="60" stroke="#d1d5db" stroke-width="1" stroke-dasharray="2,2"/>
                                    <line x1="40" y1="20" x2="460" y2="20" stroke="#d1d5db" stroke-width="1" stroke-dasharray="2,2"/>
                                    
                                    <!-- Break-even line (horizontal at 0) -->
                                    <line x1="40" y1="100" x2="460" y2="100" stroke="#ef4444" stroke-width="2" stroke-dasharray="4,4"/>
                                    
                                    <!-- Cumulative cash flow curve -->
                                    <path d="M 40 180 Q 150 120, 260 100 T 460 40" 
                                          stroke="#10b981" stroke-width="3" fill="none"/>
                                    
                                    <!-- Break-even point -->
                                    <circle cx="260" cy="100" r="6" fill="#10b981"/>
                                    <text x="260" y="90" text-anchor="middle" font-size="12" font-weight="600" fill="#10b981">Month 18</text>
                                    
                                    <!-- Axes -->
                                    <line x1="40" y1="20" x2="40" y2="180" stroke="#374151" stroke-width="2"/>
                                    <line x1="40" y1="180" x2="460" y2="180" stroke="#374151" stroke-width="2"/>
                                    
                                    <!-- Y-axis labels -->
                                    <text x="30" y="185" text-anchor="end" font-size="10" fill="#6b7280">-$50k</text>
                                    <text x="30" y="145" text-anchor="end" font-size="10" fill="#6b7280">-$25k</text>
                                    <text x="30" y="105" text-anchor="end" font-size="10" fill="#6b7280">$0</text>
                                    <text x="30" y="65" text-anchor="end" font-size="10" fill="#6b7280">$25k</text>
                                    <text x="30" y="25" text-anchor="end" font-size="10" fill="#6b7280">$50k</text>
                                    
                                    <!-- X-axis labels -->
                                    <text x="40" y="200" text-anchor="middle" font-size="10" fill="#6b7280">0</text>
                                    <text x="150" y="200" text-anchor="middle" font-size="10" fill="#6b7280">12mo</text>
                                    <text x="260" y="200" text-anchor="middle" font-size="10" fill="#6b7280">24mo</text>
                                    <text x="370" y="200" text-anchor="middle" font-size="10" fill="#6b7280">36mo</text>
                                    <text x="460" y="200" text-anchor="middle" font-size="10" fill="#6b7280">48mo</text>
                                </svg>
                            </div>
                        </div>
                        <div>
                            <!-- Break-even Metrics -->
                            <div style="background: #dcfce7; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                                <div style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">Break-even Point</div>
                                <div style="font-size: 24px; font-weight: 700; color: var(--success-green);">Month 18</div>
                                <div style="font-size: 12px; color: var(--gray-600);">June 2026</div>
                            </div>
                            
                            <div style="display: flex; flex-direction: column; gap: 12px;">
                                <div style="padding: 12px; background: white; border: 1px solid var(--gray-200); border-radius: 6px;">
                                    <div style="font-size: 12px; color: var(--gray-600);">Initial Investment</div>
                                    <div style="font-size: 16px; font-weight: 600;">$169,980</div>
                                </div>
                                <div style="padding: 12px; background: white; border: 1px solid var(--gray-200); border-radius: 6px;">
                                    <div style="font-size: 12px; color: var(--gray-600);">Monthly Cash Flow</div>
                                    <div style="font-size: 16px; font-weight: 600; color: var(--success-green);">+$8,500</div>
                                </div>
                                <div style="padding: 12px; background: white; border: 1px solid var(--gray-200); border-radius: 6px;">
                                    <div style="font-size: 12px; color: var(--gray-600);">5-Year Total Return</div>
                                    <div style="font-size: 16px; font-weight: 600; color: var(--success-green);">+$340,020</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tax Impact Analysis -->
                <div class="card" style="margin-top: 24px;">
                    <h3 class="h3" style="margin-bottom: 20px;">Tax Impact Analysis</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                        <div>
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">Short-Term Rental Tax Impact</h4>
                            <div style="background: var(--gray-50); padding: 16px; border-radius: 8px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="font-size: 13px;">Gross Rental Income</span>
                                    <span style="font-size: 13px; font-weight: 600;">$132,528</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="font-size: 13px;">Less: Deductible Expenses</span>
                                    <span style="font-size: 13px; font-weight: 600; color: var(--danger-red);">-$62,352</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid var(--gray-300);">
                                    <span style="font-size: 13px;">Net Taxable Income</span>
                                    <span style="font-size: 13px; font-weight: 600;">$70,176</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="font-size: 13px;">Est. Tax (30% bracket)</span>
                                    <span style="font-size: 13px; font-weight: 600; color: var(--danger-red);">-$21,053</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding-top: 8px; border-top: 2px solid var(--gray-400);">
                                    <span style="font-size: 14px; font-weight: 600;">After-Tax Income</span>
                                    <span style="font-size: 16px; font-weight: 700; color: var(--success-green);">$49,123</span>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">Long-Term Rental Tax Impact</h4>
                            <div style="background: var(--gray-50); padding: 16px; border-radius: 8px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="font-size: 13px;">Gross Rental Income</span>
                                    <span style="font-size: 13px; font-weight: 600;">$48,000</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="font-size: 13px;">Less: Deductible Expenses</span>
                                    <span style="font-size: 13px; font-weight: 600; color: var(--danger-red);">-$13,332</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid var(--gray-300);">
                                    <span style="font-size: 13px;">Net Taxable Income</span>
                                    <span style="font-size: 13px; font-weight: 600;">$34,668</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="font-size: 13px;">Est. Tax (30% bracket)</span>
                                    <span style="font-size: 13px; font-weight: 600; color: var(--danger-red);">-$10,400</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding-top: 8px; border-top: 2px solid var(--gray-400);">
                                    <span style="font-size: 14px; font-weight: 600;">After-Tax Income</span>
                                    <span style="font-size: 16px; font-weight: 700; color: var(--gray-700);">$24,268</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 16px; padding: 12px; background: #fef3c7; border-radius: 8px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 16px;">‚ö†Ô∏è</span>
                            <span style="font-size: 13px;"><strong>Note:</strong> Tax calculations are estimates based on typical rates. Consult a tax professional for accurate assessment. Deductible expenses include mortgage interest, property tax, insurance, maintenance, and depreciation.</span>
                        </div>
                    </div>
                </div>
                
                <!-- Sensitivity Analysis (NEWLY ADDED) -->
                <div class="card" style="position: relative; margin-top: 24px;">
                    <span class="newly-added-badge">Newly Added</span>
                    <h3 class="h3" style="margin-bottom: 20px;">Sensitivity Analysis</h3>
                    <p style="color: var(--gray-600); margin-bottom: 24px;">Impact of market changes on your returns</p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                        <!-- Occupancy Rate Sensitivity -->
                        <div style="background: var(--gray-50); padding: 16px; border-radius: 8px;">
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">STR Occupancy Impact</h4>
                            <div style="space-y: 8px;">
                                <div style="display: flex; justify-content: space-between; font-size: 13px;">
                                    <span>50% occupancy:</span>
                                    <span style="font-weight: 600; color: var(--error-red);">-$1,200/mo</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; font-size: 13px;">
                                    <span>60% occupancy:</span>
                                    <span style="font-weight: 600;">$2,100/mo</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; font-size: 13px; padding: 4px; background: white; border-radius: 4px;">
                                    <span>75% occupancy:</span>
                                    <span style="font-weight: 600; color: var(--success-green);">$8,500/mo</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; font-size: 13px;">
                                    <span>85% occupancy:</span>
                                    <span style="font-weight: 600; color: var(--success-green);">$11,800/mo</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Interest Rate Sensitivity -->
                        <div style="background: var(--gray-50); padding: 16px; border-radius: 8px;">
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">Interest Rate Impact</h4>
                            <div style="space-y: 8px;">
                                <div style="display: flex; justify-content: space-between; font-size: 13px;">
                                    <span>4% rate:</span>
                                    <span style="font-weight: 600;">$3,858/mo</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; font-size: 13px; padding: 4px; background: white; border-radius: 4px;">
                                    <span>5% rate:</span>
                                    <span style="font-weight: 600;">$4,269/mo</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; font-size: 13px;">
                                    <span>6% rate:</span>
                                    <span style="font-weight: 600; color: var(--error-red);">$4,699/mo</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; font-size: 13px;">
                                    <span>7% rate:</span>
                                    <span style="font-weight: 600; color: var(--error-red);">$5,147/mo</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Nightly Rate Sensitivity -->
                        <div style="background: var(--gray-50); padding: 16px; border-radius: 8px;">
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">Nightly Rate Impact</h4>
                            <div style="space-y: 8px;">
                                <div style="display: flex; justify-content: space-between; font-size: 13px;">
                                    <span>$250/night:</span>
                                    <span style="font-weight: 600;">$3,900/mo</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; font-size: 13px;">
                                    <span>$300/night:</span>
                                    <span style="font-weight: 600;">$5,850/mo</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; font-size: 13px; padding: 4px; background: white; border-radius: 4px;">
                                    <span>$363/night:</span>
                                    <span style="font-weight: 600; color: var(--success-green);">$8,500/mo</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; font-size: 13px;">
                                    <span>$450/night:</span>
                                    <span style="font-weight: 600; color: var(--success-green);">$12,150/mo</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #f0f9ff; padding: 12px; border-radius: 8px; margin-top: 20px;">
                        <p style="font-size: 12px; color: var(--gray-700); margin: 0;">
                            <strong>Break-even Analysis:</strong> STR needs 27% occupancy to match LTR income. Current market average is 75%, providing a comfortable margin of safety.
                        </p>
                    </div>
                </div>
            </section>
            
            <!-- STR vs LTR Comparison Section (NEWLY ADDED) -->
            <section class="card" id="str-ltr-comparison-section" style="position: relative; margin-top: 24px;">
                <span class="newly-added-badge">Newly Added</span>
                <h2 class="h2" style="margin-bottom: 24px;">STR vs LTR Comprehensive Comparison <span class="data-source-badge calculated">Calculated</span></h2>
                <p style="color: var(--gray-600); margin-bottom: 24px;">Side-by-side analysis of both rental strategies</p>
                
                <!-- Financial Comparison Table -->
                <div style="background: var(--gray-50); padding: 20px; border-radius: 12px; margin-bottom: 24px;">
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">Financial Comparison</h3>
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="border-bottom: 2px solid var(--gray-300);">
                                <th style="text-align: left; padding: 12px; font-size: 14px; font-weight: 600;">Metric</th>
                                <th style="text-align: center; padding: 12px; font-size: 14px; font-weight: 600; color: var(--primary-blue);">STR</th>
                                <th style="text-align: center; padding: 12px; font-size: 14px; font-weight: 600; color: var(--gray-700);">LTR</th>
                                <th style="text-align: center; padding: 12px; font-size: 14px; font-weight: 600;">Difference</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="background: white;">
                                <td style="padding: 12px; font-size: 14px;">Gross Monthly Revenue</td>
                                <td style="padding: 12px; text-align: center; font-weight: 600;">$11,044</td>
                                <td style="padding: 12px; text-align: center; font-weight: 600;">$3,100</td>
                                <td style="padding: 12px; text-align: center; font-weight: 600; color: var(--success-green);">+$7,944</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; font-size: 14px;">Operating Expenses</td>
                                <td style="padding: 12px; text-align: center; font-weight: 600;">$5,196</td>
                                <td style="padding: 12px; text-align: center; font-weight: 600;">$1,111</td>
                                <td style="padding: 12px; text-align: center; font-weight: 600; color: var(--error-red);">+$4,085</td>
                            </tr>
                            <tr style="background: white;">
                                <td style="padding: 12px; font-size: 14px;">Net Operating Income</td>
                                <td style="padding: 12px; text-align: center; font-weight: 600;">$5,848</td>
                                <td style="padding: 12px; text-align: center; font-weight: 600;">$1,989</td>
                                <td style="padding: 12px; text-align: center; font-weight: 600; color: var(--success-green);">+$3,859</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; font-size: 14px;">Annual Net Income</td>
                                <td style="padding: 12px; text-align: center; font-weight: 600;">$70,176</td>
                                <td style="padding: 12px; text-align: center; font-weight: 600;">$23,868</td>
                                <td style="padding: 12px; text-align: center; font-weight: 600; color: var(--success-green);">+$46,308</td>
                            </tr>
                            <tr style="background: linear-gradient(135deg, #f0f9ff, #e0f2fe);">
                                <td style="padding: 12px; font-size: 14px; font-weight: 600;">ROI on Investment</td>
                                <td style="padding: 12px; text-align: center; font-weight: 700; color: var(--success-green);">35.1%</td>
                                <td style="padding: 12px; text-align: center; font-weight: 700;">11.9%</td>
                                <td style="padding: 12px; text-align: center; font-weight: 700; color: var(--success-green);">+23.2%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Scenario Analysis -->
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 24px;">
                    <div style="background: #fee2e2; padding: 16px; border-radius: 8px;">
                        <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">Conservative Scenario</h4>
                        <p style="font-size: 12px; color: var(--gray-600); margin-bottom: 12px;">50% STR occupancy</p>
                        <div style="display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 4px;">
                            <span>STR Income:</span>
                            <span style="font-weight: 600;">$5,522/mo</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 4px;">
                            <span>LTR Income:</span>
                            <span style="font-weight: 600;">$3,100/mo</span>
                        </div>
                        <div style="padding-top: 8px; border-top: 1px solid var(--gray-300); margin-top: 8px;">
                            <div style="display: flex; justify-content: space-between; font-size: 13px;">
                                <span>Winner:</span>
                                <span style="font-weight: 600; color: var(--primary-blue);">STR by $2,422</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #fef3c7; padding: 16px; border-radius: 8px;">
                        <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">Realistic Scenario</h4>
                        <p style="font-size: 12px; color: var(--gray-600); margin-bottom: 12px;">75% STR occupancy</p>
                        <div style="display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 4px;">
                            <span>STR Income:</span>
                            <span style="font-weight: 600;">$11,044/mo</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 4px;">
                            <span>LTR Income:</span>
                            <span style="font-weight: 600;">$3,100/mo</span>
                        </div>
                        <div style="padding-top: 8px; border-top: 1px solid var(--gray-300); margin-top: 8px;">
                            <div style="display: flex; justify-content: space-between; font-size: 13px;">
                                <span>Winner:</span>
                                <span style="font-weight: 600; color: var(--success-green);">STR by $7,944</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #dcfce7; padding: 16px; border-radius: 8px;">
                        <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">Optimistic Scenario</h4>
                        <p style="font-size: 12px; color: var(--gray-600); margin-bottom: 12px;">85% STR occupancy</p>
                        <div style="display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 4px;">
                            <span>STR Income:</span>
                            <span style="font-weight: 600;">$12,517/mo</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 4px;">
                            <span>LTR Income:</span>
                            <span style="font-weight: 600;">$3,100/mo</span>
                        </div>
                        <div style="padding-top: 8px; border-top: 1px solid var(--gray-300); margin-top: 8px;">
                            <div style="display: flex; justify-content: space-between; font-size: 13px;">
                                <span>Winner:</span>
                                <span style="font-weight: 600; color: var(--success-green);">STR by $9,417</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Risk & Operational Comparison -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                    <div>
                        <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">Risk Assessment</h3>
                        <div style="background: var(--gray-50); padding: 16px; border-radius: 8px;">
                            <div style="margin-bottom: 12px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="font-size: 14px;">Regulatory Risk</span>
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    <div style="flex: 1;">
                                        <div style="font-size: 12px; color: var(--gray-600); margin-bottom: 4px;">STR</div>
                                        <div style="height: 8px; background: linear-gradient(to right, var(--error-red) 80%, var(--gray-200) 80%); border-radius: 4px;"></div>
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-size: 12px; color: var(--gray-600); margin-bottom: 4px;">LTR</div>
                                        <div style="height: 8px; background: linear-gradient(to right, var(--success-green) 20%, var(--gray-200) 20%); border-radius: 4px;"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 12px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="font-size: 14px;">Market Risk</span>
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    <div style="flex: 1;">
                                        <div style="font-size: 12px; color: var(--gray-600); margin-bottom: 4px;">STR</div>
                                        <div style="height: 8px; background: linear-gradient(to right, var(--warning-yellow) 60%, var(--gray-200) 60%); border-radius: 4px;"></div>
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-size: 12px; color: var(--gray-600); margin-bottom: 4px;">LTR</div>
                                        <div style="height: 8px; background: linear-gradient(to right, var(--primary-blue) 30%, var(--gray-200) 30%); border-radius: 4px;"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="font-size: 14px;">Operational Complexity</span>
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    <div style="flex: 1;">
                                        <div style="font-size: 12px; color: var(--gray-600); margin-bottom: 4px;">STR</div>
                                        <div style="height: 8px; background: linear-gradient(to right, var(--error-red) 90%, var(--gray-200) 90%); border-radius: 4px;"></div>
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-size: 12px; color: var(--gray-600); margin-bottom: 4px;">LTR</div>
                                        <div style="height: 8px; background: linear-gradient(to right, var(--success-green) 20%, var(--gray-200) 20%); border-radius: 4px;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">Time & Effort Required</h3>
                        <div style="background: var(--gray-50); padding: 16px; border-radius: 8px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                <div>
                                    <h4 style="font-size: 14px; font-weight: 600; color: var(--primary-blue); margin-bottom: 8px;">STR</h4>
                                    <ul style="list-style: none; padding: 0; margin: 0;">
                                        <li style="font-size: 12px; margin-bottom: 4px;">‚Ä¢ Daily guest communication</li>
                                        <li style="font-size: 12px; margin-bottom: 4px;">‚Ä¢ Weekly cleanings</li>
                                        <li style="font-size: 12px; margin-bottom: 4px;">‚Ä¢ Listing optimization</li>
                                        <li style="font-size: 12px; margin-bottom: 4px;">‚Ä¢ Price adjustments</li>
                                        <li style="font-size: 12px; font-weight: 600; color: var(--error-red);">20-30 hrs/month</li>
                                    </ul>
                                </div>
                                <div>
                                    <h4 style="font-size: 14px; font-weight: 600; color: var(--gray-700); margin-bottom: 8px;">LTR</h4>
                                    <ul style="list-style: none; padding: 0; margin: 0;">
                                        <li style="font-size: 12px; margin-bottom: 4px;">‚Ä¢ Annual lease renewal</li>
                                        <li style="font-size: 12px; margin-bottom: 4px;">‚Ä¢ Quarterly inspections</li>
                                        <li style="font-size: 12px; margin-bottom: 4px;">‚Ä¢ Occasional maintenance</li>
                                        <li style="font-size: 12px; margin-bottom: 4px;">‚Ä¢ Tenant screening</li>
                                        <li style="font-size: 12px; font-weight: 600; color: var(--success-green);">2-5 hrs/month</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Final Recommendation -->
                <div style="background: linear-gradient(135deg, #dcfce7, #bbf7d0); padding: 20px; border-radius: 12px; margin-top: 24px;">
                    <div style="display: flex; align-items: center; gap: 16px;">
                        <span style="font-size: 32px;">üèÜ</span>
                        <div>
                            <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 8px;">Recommendation: Short-Term Rental</h3>
                            <p style="font-size: 14px; color: var(--gray-700); margin: 0;">
                                Based on current market conditions, STR offers 194% higher returns than LTR. The property's location in a high-demand tourist area, 
                                combined with strong Airbnb comparables showing 75% occupancy rates, makes STR the optimal strategy. 
                                However, ensure compliance with local regulations and consider the increased operational requirements.
                            </p>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- 7. LTR Analysis Section (Hidden by default, shown when LTR nav is clicked) -->
            <section id="ltr-analysis-section" data-section="ltr-section" style="display: none;">
                <!-- How We Calculate Your Rental Estimate -->
                <div class="card" style="padding: 32px; margin-bottom: 24px;">
                    <h2 class="h2" style="margin-bottom: 24px;">How We Calculate Your Rental Estimate <span class="data-source-badge ai-enhanced">AI + APIs</span></h2>
                    
                    <!-- Property Info Box -->
                    <div style="background: #f0f8ff; padding: 16px 20px; border-radius: 8px; margin-bottom: 32px;">
                        <div style="color: #1e40af; margin-bottom: 8px; font-size: 14px;">
                            <strong>Your Property:</strong> 1-bedroom apartment in ABSOLUTE AVENUE Mississauga (N/A sq ft)
                        </div>
                        <div style="color: #1e40af; font-size: 14px;">
                            <strong>Estimated Monthly Rent:</strong> <span id="estimatedRentDisplay" style="font-size: 16px;">$1,848</span> based on the analysis below
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 48px;">
                        <!-- Primary Data Sources -->
                        <div>
                            <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 20px; color: var(--gray-900);">Primary Data Sources</h3>
                            
                            <div style="margin-bottom: 20px;">
                                <div style="display: flex; align-items: flex-start; margin-bottom: 16px;">
                                    <span style="color: #10b981; margin-right: 10px; font-size: 18px;">‚úì</span>
                                    <div>
                                        <div style="font-weight: 600; margin-bottom: 4px;">CMHC Rental Market Reports</div>
                                        <div style="color: #6b7280; font-size: 13px; line-height: 1.5;">Q4 2023: ABSOLUTE AVENUE Mississauga average 1BR rent: $1,748-$1,948</div>
                                    </div>
                                </div>
                                
                                <div style="display: flex; align-items: flex-start; margin-bottom: 16px;">
                                    <span style="color: #10b981; margin-right: 10px; font-size: 18px;">‚úì</span>
                                    <div>
                                        <div style="font-weight: 600; margin-bottom: 4px;">Local Real Estate Board Data</div>
                                        <div style="color: #6b7280; font-size: 13px; line-height: 1.5;">2024 YTD: 5.2% rental growth, 2.1% vacancy</div>
                                    </div>
                                </div>
                                
                                <div style="display: flex; align-items: flex-start; margin-bottom: 16px;">
                                    <span style="color: #10b981; margin-right: 10px; font-size: 18px;">‚úì</span>
                                    <div>
                                        <div style="font-weight: 600; margin-bottom: 4px;">Census & Demographics</div>
                                        <div style="color: #6b7280; font-size: 13px; line-height: 1.5;">ABSOLUTE AVENUE Mississauga: Growing population, high rental demand</div>
                                    </div>
                                </div>
                                
                                <div style="display: flex; align-items: flex-start;">
                                    <span style="color: #10b981; margin-right: 10px; font-size: 18px;">‚úì</span>
                                    <div>
                                        <div style="font-weight: 600; margin-bottom: 4px;">Provincial Rent Guidelines</div>
                                        <div style="color: #6b7280; font-size: 13px; line-height: 1.5;">2024: 2.5%, 2023: 2.5%, 2022: 1.2%, 2021: 0%, 2020: 2.2%</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Analysis Factors -->
                        <div>
                            <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 20px; color: var(--gray-900);">Analysis Factors</h3>
                            
                            <div style="margin-bottom: 20px;">
                                <div style="margin-bottom: 16px;">
                                    <div style="font-weight: 600; margin-bottom: 4px;">‚Ä¢ Property Features</div>
                                    <div style="color: #6b7280; font-size: 13px; margin-left: 15px; line-height: 1.5;">1 bed, 1 bath, N/A sq ft = Above average unit</div>
                                </div>
                                
                                <div style="margin-bottom: 16px;">
                                    <div style="font-weight: 600; margin-bottom: 4px;">‚Ä¢ Location Premium</div>
                                    <div style="color: #6b7280; font-size: 13px; margin-left: 15px; line-height: 1.5;">ABSOLUTE AVENUE Mississauga: +5-10% vs regional average</div>
                                </div>
                                
                                <div>
                                    <div style="font-weight: 600; margin-bottom: 4px;">‚Ä¢ Market Conditions</div>
                                    <div style="color: #6b7280; font-size: 13px; margin-left: 15px; line-height: 1.5;">High demand, 2.1% vacancy = Landlord's market</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Note -->
                    <div style="background: #f9fafb; padding: 16px; border-radius: 8px; margin-top: 28px; border: 1px solid #e5e7eb;">
                        <p style="font-size: 13px; color: #6b7280; margin: 0; line-height: 1.6;">
                            <strong>Note:</strong> This AI-powered analysis uses aggregated market data from multiple sources. For the most current rates, we recommend checking Rentals.ca, PadMapper, or consulting local property managers. Actual rents may vary based on specific unit features, condition, and timing.
                        </p>
                    </div>
                </div>

                <!-- Long-Term Rental Calculator with Charts -->
                <div class="card" style="padding: 32px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                        <h2 class="h2" style="margin: 0;">Long-Term Rental Calculator <span class="data-source-badge ai-enhanced">AI Research</span></h2>
                        <button style="padding: 8px 16px; background: var(--primary-blue); color: white; border: none; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer;">
                            Reset to Defaults
                        </button>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 48px;">
                        <!-- Left Side: Sliders -->
                        <div>
                            <div style="margin-bottom: 32px;">
                                <h3 style="font-size: 16px; font-weight: 600; color: var(--gray-900); margin-bottom: 20px;">Rental Income Settings</h3>
                                
                                <!-- Monthly Rent Slider -->
                                <div style="margin-bottom: 24px;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                        <label style="font-size: 14px; color: var(--gray-700);">Monthly Rent: <span style="font-weight: 600; color: var(--gray-900);">$3,100</span></label>
                                    </div>
                                    <div style="position: relative;">
                                        <input type="range" id="ltrMonthlyRentNew" min="2000" max="5000" value="3100" 
                                               style="width: 100%; height: 6px; background: linear-gradient(to right, var(--primary-blue) 36%, var(--gray-200) 36%); border-radius: 3px; outline: none; -webkit-appearance: none;">
                                        <div style="display: flex; justify-content: space-between; margin-top: 4px;">
                                            <span style="font-size: 11px; color: var(--gray-500);">$2,000</span>
                                            <span style="font-size: 11px; color: var(--gray-500);">$3,000</span>
                                            <span style="font-size: 11px; color: var(--gray-500);">$4,000</span>
                                            <span style="font-size: 11px; color: var(--gray-500);">$5,000</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Vacancy Rate Slider -->
                                <div style="margin-bottom: 24px;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                        <label style="font-size: 14px; color: var(--gray-700);">Vacancy Rate: <span style="font-weight: 600; color: var(--gray-900);">0%</span></label>
                                    </div>
                                    <div style="position: relative;">
                                        <input type="range" id="ltrVacancyRateNew" min="0" max="100" value="0" 
                                               style="width: 100%; height: 6px; background: linear-gradient(to right, var(--primary-blue) 0%, var(--gray-200) 0%); border-radius: 3px; outline: none; -webkit-appearance: none;">
                                        <div style="display: flex; justify-content: space-between; margin-top: 4px;">
                                            <span style="font-size: 11px; color: var(--gray-500);">0%</span>
                                            <span style="font-size: 11px; color: var(--gray-500);">25%</span>
                                            <span style="font-size: 11px; color: var(--gray-500);">50%</span>
                                            <span style="font-size: 11px; color: var(--gray-500);">75%</span>
                                            <span style="font-size: 11px; color: var(--gray-500);">100%</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Annual Rent Increase Slider -->
                                <div style="margin-bottom: 32px;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                        <label style="font-size: 14px; color: var(--gray-700);">Annual Rent Increase: <span style="font-weight: 600; color: var(--gray-900);">2.5%</span></label>
                                    </div>
                                    <div style="position: relative;">
                                        <input type="range" id="ltrAnnualIncreaseNew" min="0" max="10" value="2.5" step="0.5"
                                               style="width: 100%; height: 6px; background: linear-gradient(to right, var(--primary-blue) 25%, var(--gray-200) 25%); border-radius: 3px; outline: none; -webkit-appearance: none;">
                                        <div style="display: flex; justify-content: space-between; margin-top: 4px;">
                                            <span style="font-size: 11px; color: var(--gray-500);">0%</span>
                                            <span style="font-size: 11px; color: var(--gray-500);">2.5%</span>
                                            <span style="font-size: 11px; color: var(--gray-500);">5%</span>
                                            <span style="font-size: 11px; color: var(--gray-500);">7.5%</span>
                                            <span style="font-size: 11px; color: var(--gray-500);">10%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Projected Annual Revenue Box -->
                            <div style="background: linear-gradient(135deg, #EBF8FF 0%, #F3E8FF 100%); padding: 20px; border-radius: 12px;">
                                <h3 style="font-size: 14px; font-weight: 500; color: var(--gray-700); margin-bottom: 8px;">Projected Annual Revenue</h3>
                                <div style="font-size: 32px; font-weight: 700; color: var(--primary-blue); margin-bottom: 4px;" id="ltr-annual-income">$37,200</div>
                                <div style="font-size: 13px; color: var(--gray-600);">Annual income after vacancy</div>
                            </div>
                        </div>
                        
                        <!-- Right Side: Bar Chart -->
                        <div>
                            <h3 style="font-size: 16px; font-weight: 600; color: var(--gray-900); margin-bottom: 20px;">5-Year Revenue Projection</h3>
                            
                            <div style="position: relative; height: 300px; display: flex; align-items: flex-end; justify-content: space-around; padding: 20px 0;">
                                <!-- Year 1 Bar -->
                                <div style="display: flex; flex-direction: column; align-items: center; width: 80px;">
                                    <div style="font-size: 14px; font-weight: 600; color: var(--gray-700); margin-bottom: 8px;">$37,200</div>
                                    <div style="width: 100%; background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%); border-radius: 4px 4px 0 0; position: relative; height: 180px;">
                                    </div>
                                    <div style="margin-top: 8px;">
                                        <div style="font-size: 13px; font-weight: 600; color: var(--gray-900);">Year 1</div>
                                        <div style="font-size: 11px; color: var(--gray-500);">Current</div>
                                    </div>
                                </div>
                                
                                <!-- Year 3 Bar -->
                                <div style="display: flex; flex-direction: column; align-items: center; width: 80px;">
                                    <div style="font-size: 14px; font-weight: 600; color: var(--gray-700); margin-bottom: 8px;">$39,061</div>
                                    <div style="width: 100%; background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%); border-radius: 4px 4px 0 0; position: relative; height: 189px;">
                                    </div>
                                    <div style="margin-top: 8px;">
                                        <div style="font-size: 13px; font-weight: 600; color: var(--gray-900);">Year 3</div>
                                        <div style="font-size: 11px; color: var(--gray-500);">+5.0%</div>
                                    </div>
                                </div>
                                
                                <!-- Year 5 Bar -->
                                <div style="display: flex; flex-direction: column; align-items: center; width: 80px;">
                                    <div style="font-size: 14px; font-weight: 600; color: var(--gray-700); margin-bottom: 8px;">$41,062</div>
                                    <div style="width: 100%; background: linear-gradient(135deg, #10B981 0%, #059669 100%); border-radius: 4px 4px 0 0; position: relative; height: 199px;">
                                    </div>
                                    <div style="margin-top: 8px;">
                                        <div style="font-size: 13px; font-weight: 600; color: var(--gray-900);">Year 5</div>
                                        <div style="font-size: 11px; color: var(--gray-500);">+10.4%</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Summary Stats -->
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-top: 32px;">
                                <div style="text-align: center; padding: 12px; background: var(--gray-50); border-radius: 8px;">
                                    <div style="font-size: 11px; color: var(--gray-600); margin-bottom: 4px;">5-Year Total</div>
                                    <div style="font-size: 18px; font-weight: 700; color: var(--gray-900);">$195,535</div>
                                </div>
                                <div style="text-align: center; padding: 12px; background: var(--gray-50); border-radius: 8px;">
                                    <div style="font-size: 11px; color: var(--gray-600); margin-bottom: 4px;">Average Annual</div>
                                    <div style="font-size: 18px; font-weight: 700; color: var(--primary-blue);">$39,107</div>
                                </div>
                                <div style="text-align: center; padding: 12px; background: var(--gray-50); border-radius: 8px;">
                                    <div style="font-size: 11px; color: var(--gray-600); margin-bottom: 4px;">vs STR Rental</div>
                                    <div style="font-size: 18px; font-weight: 700; color: var(--danger-red);">-$301,050</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- LTR Rental Comparables (NEWLY ADDED) -->
                <div class="card" style="position: relative; margin-top: 24px;">
                    <span class="newly-added-badge">Newly Added</span>
                    <h2 class="h2" style="margin-bottom: 20px;">Long-Term Rental Comparables <span class="data-source-badge ai-enhanced">AI Research</span></h2>
                    <p style="color: var(--gray-600); margin-bottom: 24px;">Current rental listings in your area from Rentals.ca and Kijiji</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;" id="rental-comparables-container">
                        <!-- Rental Comparable 1 -->
                        <div style="border: 1px solid var(--gray-200); border-radius: 12px; overflow: hidden;">
                            <div style="background: linear-gradient(135deg, #f3f4f6, #e5e7eb); height: 160px; position: relative;">
                                <div style="position: absolute; bottom: 10px; left: 10px; background: white; padding: 6px 12px; border-radius: 6px; font-weight: 600;">
                                    $3,200/mo
                                </div>
                            </div>
                            <div style="padding: 16px;">
                                <h4 style="font-size: 15px; font-weight: 600; margin-bottom: 8px;">2BR Condo ‚Ä¢ Liberty Village</h4>
                                <div style="display: flex; gap: 12px; margin-bottom: 12px;">
                                    <span style="font-size: 13px; color: var(--gray-600);">2 Bed</span>
                                    <span style="font-size: 13px; color: var(--gray-600);">2 Bath</span>
                                    <span style="font-size: 13px; color: var(--gray-600);">950 sqft</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-size: 12px; color: var(--success-green); font-weight: 500;">Listed 3 days ago</span>
                                    <a href="#" style="font-size: 12px; color: var(--primary-blue); text-decoration: none;">Rentals.ca ‚Üí</a>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Rental Comparable 2 -->
                        <div style="border: 1px solid var(--gray-200); border-radius: 12px; overflow: hidden;">
                            <div style="background: linear-gradient(135deg, #f3f4f6, #e5e7eb); height: 160px; position: relative;">
                                <div style="position: absolute; bottom: 10px; left: 10px; background: white; padding: 6px 12px; border-radius: 6px; font-weight: 600;">
                                    $2,950/mo
                                </div>
                            </div>
                            <div style="padding: 16px;">
                                <h4 style="font-size: 15px; font-weight: 600; margin-bottom: 8px;">2BR Apartment ‚Ä¢ King West</h4>
                                <div style="display: flex; gap: 12px; margin-bottom: 12px;">
                                    <span style="font-size: 13px; color: var(--gray-600);">2 Bed</span>
                                    <span style="font-size: 13px; color: var(--gray-600);">1 Bath</span>
                                    <span style="font-size: 13px; color: var(--gray-600);">850 sqft</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-size: 12px; color: var(--warning-yellow); font-weight: 500;">Listed 1 week ago</span>
                                    <a href="#" style="font-size: 12px; color: var(--primary-blue); text-decoration: none;">Kijiji ‚Üí</a>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Rental Comparable 3 -->
                        <div style="border: 1px solid var(--gray-200); border-radius: 12px; overflow: hidden;">
                            <div style="background: linear-gradient(135deg, #f3f4f6, #e5e7eb); height: 160px; position: relative;">
                                <div style="position: absolute; bottom: 10px; left: 10px; background: white; padding: 6px 12px; border-radius: 6px; font-weight: 600;">
                                    $3,100/mo
                                </div>
                            </div>
                            <div style="padding: 16px;">
                                <h4 style="font-size: 15px; font-weight: 600; margin-bottom: 8px;">1BR+Den ‚Ä¢ Entertainment District</h4>
                                <div style="display: flex; gap: 12px; margin-bottom: 12px;">
                                    <span style="font-size: 13px; color: var(--gray-600);">1+1 Bed</span>
                                    <span style="font-size: 13px; color: var(--gray-600);">1 Bath</span>
                                    <span style="font-size: 13px; color: var(--gray-600);">750 sqft</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-size: 12px; color: var(--gray-500); font-weight: 500;">Listed 2 weeks ago</span>
                                    <a href="#" style="font-size: 12px; color: var(--primary-blue); text-decoration: none;">Rentals.ca ‚Üí</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: var(--gray-50); padding: 12px; border-radius: 8px; margin-top: 20px;">
                        <p style="font-size: 12px; color: var(--gray-600); margin: 0;">
                            <strong>Data Source:</strong> Real-time listings from Rentals.ca, Kijiji, and PadMapper via Perplexity AI research
                        </p>
                    </div>
                </div>
                
                <!-- LTR Operating Expense Breakdown (NEWLY ADDED) -->
                <div class="card" style="position: relative; margin-top: 24px;">
                    <span class="newly-added-badge">Newly Added</span>
                    <h2 class="h2" style="margin-bottom: 20px;">Operating Expense Breakdown <span class="data-source-badge calculated">Calculated</span></h2>
                    <p style="color: var(--gray-600); margin-bottom: 24px;">Monthly expenses for long-term rental operation</p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                        <div>
                            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">Fixed Expenses</h3>
                            <div style="space-y: 12px;">
                                <div style="display: flex; justify-content: space-between; padding: 12px; background: var(--gray-50); border-radius: 8px; margin-bottom: 8px;">
                                    <span style="font-size: 14px;">Property Tax</span>
                                    <span style="font-size: 14px; font-weight: 600;">$625/mo</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 12px; background: var(--gray-50); border-radius: 8px; margin-bottom: 8px;">
                                    <span style="font-size: 14px;">Insurance</span>
                                    <span style="font-size: 14px; font-weight: 600;">$167/mo</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 12px; background: var(--gray-50); border-radius: 8px; margin-bottom: 8px;">
                                    <span style="font-size: 14px;">Condo Fees</span>
                                    <span style="font-size: 14px; font-weight: 600;">$450/mo</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 12px; background: var(--gray-50); border-radius: 8px;">
                                    <span style="font-size: 14px;">Mortgage Payment</span>
                                    <span style="font-size: 14px; font-weight: 600;">$3,200/mo</span>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">Variable Expenses</h3>
                            <div style="space-y: 12px;">
                                <div style="display: flex; justify-content: space-between; padding: 12px; background: var(--gray-50); border-radius: 8px; margin-bottom: 8px;">
                                    <span style="font-size: 14px;">Property Management (8%)</span>
                                    <span style="font-size: 14px; font-weight: 600;">$248/mo</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 12px; background: var(--gray-50); border-radius: 8px; margin-bottom: 8px;">
                                    <span style="font-size: 14px;">Maintenance Reserve (1%)</span>
                                    <span style="font-size: 14px; font-weight: 600;">$708/mo</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 12px; background: var(--gray-50); border-radius: 8px; margin-bottom: 8px;">
                                    <span style="font-size: 14px;">Vacancy Allowance (5%)</span>
                                    <span style="font-size: 14px; font-weight: 600;">$155/mo</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 12px; background: #fef3c7; border-radius: 8px;">
                                    <span style="font-size: 14px; font-weight: 600;">Total Expenses</span>
                                    <span style="font-size: 14px; font-weight: 700; color: var(--error-red);">$5,553/mo</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #f0f9ff, #e0f2fe); padding: 16px; border-radius: 8px; margin-top: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <p style="font-size: 14px; color: var(--gray-700); margin: 0;">Monthly Rental Income</p>
                                <p style="font-size: 24px; font-weight: 700; color: var(--success-green); margin: 4px 0;">$3,100</p>
                            </div>
                            <div style="width: 1px; height: 40px; background: var(--gray-300);"></div>
                            <div>
                                <p style="font-size: 14px; color: var(--gray-700); margin: 0;">Total Monthly Expenses</p>
                                <p style="font-size: 24px; font-weight: 700; color: var(--error-red); margin: 4px 0;">$5,553</p>
                            </div>
                            <div style="width: 1px; height: 40px; background: var(--gray-300);"></div>
                            <div>
                                <p style="font-size: 14px; color: var(--gray-700); margin: 0;">Net Cash Flow</p>
                                <p style="font-size: 24px; font-weight: 700; color: var(--error-red); margin: 4px 0;">-$2,453</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Rent Control Information (NEWLY ADDED) -->
                <div class="card" style="position: relative; margin-top: 24px;">
                    <span class="newly-added-badge">Newly Added</span>
                    <h2 class="h2" style="margin-bottom: 20px;">Rent Control & Regulations <span class="data-source-badge ai-enhanced">AI Research</span></h2>
                    <p style="color: var(--gray-600); margin-bottom: 24px;">Provincial rent increase guidelines for Ontario</p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                        <div>
                            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">Current Guidelines</h3>
                            <div style="background: var(--primary-blue); background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; padding: 20px; border-radius: 12px; margin-bottom: 16px;">
                                <p style="font-size: 14px; margin-bottom: 8px;">2025 Maximum Increase</p>
                                <p style="font-size: 36px; font-weight: 700; margin: 0;">2.5%</p>
                                <p style="font-size: 12px; margin-top: 8px; opacity: 0.9;">Applies to buildings occupied before Nov 15, 2018</p>
                            </div>
                            
                            <div style="background: var(--gray-50); padding: 16px; border-radius: 8px;">
                                <p style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">Historical Rates:</p>
                                <div style="space-y: 4px;">
                                    <div style="display: flex; justify-content: space-between; font-size: 13px;">
                                        <span>2024:</span><span style="font-weight: 600;">2.5%</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; font-size: 13px;">
                                        <span>2023:</span><span style="font-weight: 600;">2.5%</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; font-size: 13px;">
                                        <span>2022:</span><span style="font-weight: 600;">1.2%</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; font-size: 13px;">
                                        <span>2021:</span><span style="font-weight: 600;">0%</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; font-size: 13px;">
                                        <span>2020:</span><span style="font-weight: 600;">2.2%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">Impact on Revenue</h3>
                            <div style="background: var(--gray-50); padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                                <p style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">5-Year Rent Projection (2.5% annual)</p>
                                <div style="space-y: 8px;">
                                    <div style="display: flex; justify-content: space-between; font-size: 14px;">
                                        <span>Year 1:</span><span style="font-weight: 600;">$3,100/mo</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; font-size: 14px;">
                                        <span>Year 2:</span><span style="font-weight: 600;">$3,178/mo</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; font-size: 14px;">
                                        <span>Year 3:</span><span style="font-weight: 600;">$3,257/mo</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; font-size: 14px;">
                                        <span>Year 4:</span><span style="font-weight: 600;">$3,338/mo</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; font-size: 14px;">
                                        <span>Year 5:</span><span style="font-weight: 600; color: var(--success-green);">$3,422/mo</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="background: #fef3c7; padding: 12px; border-radius: 8px;">
                                <p style="font-size: 13px; color: var(--gray-700); margin: 0;">
                                    <strong>Note:</strong> New buildings (after Nov 15, 2018) are not rent controlled and can increase rent at any amount.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                
            </section>
                </div> <!-- End Main Content Area -->
            </div> <!-- End Flex Container -->
        </div> <!-- End Container -->
    </main>
    
    <script>
        // Global property price for API integration
        window.propertyPrice = 849900;
        
        // Define updateFinancialCalculator early so it's available for inline handlers
        window.updateFinancialCalculator = function() {
            // Call the full implementation if it exists
            if (typeof updateFinancialCalculatorFull !== 'undefined') {
                updateFinancialCalculatorFull();
            }
        }
        
        // Sidebar Navigation Functions
        window.handleNavClick = function(button, section) {
            // Remove active class from all buttons
            document.querySelectorAll('.sidebar-nav-item').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Add active class to clicked button
            button.classList.add('active');
            
            // Get main content area and important elements
            const mainContent = document.querySelector('main > .container > div[style*="display: flex"] > div[style*="flex: 1"]');
            const ltrSection = document.getElementById('ltr-analysis-section');
            const propertyHeader = document.getElementById('property-header');
            
            // Show/hide sections based on selection
            if (section === 'ltr') {
                // Hide ALL content except property header and LTR section
                if (mainContent) {
                    const allSections = mainContent.querySelectorAll(':scope > *');
                    allSections.forEach(el => {
                        // Keep property header visible
                        if (el.id === 'property-header') {
                            el.style.display = '';
                        } else if (el.id === 'ltr-analysis-section') {
                            el.style.display = 'block';
                        } else {
                            el.style.display = 'none';
                        }
                    });
                }
                // Switch to LTR metrics in header
                document.querySelectorAll('.str-metric').forEach(el => el.style.display = 'none');
                document.querySelectorAll('.ltr-metric').forEach(el => el.style.display = '');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else if (section === 'str') {
                // Show property header and STR content (hide LTR, investment grade card, and financial calculator)
                if (mainContent) {
                    const allSections = mainContent.querySelectorAll(':scope > *');
                    allSections.forEach(el => {
                        if (el.id === 'ltr-analysis-section' || 
                            el.id === 'investment-grade-card' || 
                            el.id === 'financial-calculator-section') {
                            el.style.display = 'none';
                        } else {
                            el.style.display = '';
                        }
                    });
                }
                // Switch to STR metrics in header
                document.querySelectorAll('.str-metric').forEach(el => el.style.display = '');
                document.querySelectorAll('.ltr-metric').forEach(el => el.style.display = 'none');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else if (section === 'overview') {
                // Show property header AND investment grade card for overview
                if (mainContent) {
                    const allSections = mainContent.querySelectorAll(':scope > *');
                    allSections.forEach(el => {
                        if (el.id === 'property-header' || el.id === 'investment-grade-card') {
                            el.style.display = '';
                        } else {
                            el.style.display = 'none';
                        }
                    });
                }
                // Switch to STR metrics in header
                document.querySelectorAll('.str-metric').forEach(el => el.style.display = '');
                document.querySelectorAll('.ltr-metric').forEach(el => el.style.display = 'none');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else if (section === 'financial') {
                // Show property header and financial calculator
                if (mainContent) {
                    const allSections = mainContent.querySelectorAll(':scope > *');
                    allSections.forEach(el => {
                        if (el.id === 'property-header' || el.id === 'financial-calculator-section') {
                            el.style.display = '';
                        } else {
                            el.style.display = 'none';
                        }
                    });
                }
                // Switch to STR metrics in header
                document.querySelectorAll('.str-metric').forEach(el => el.style.display = '');
                document.querySelectorAll('.ltr-metric').forEach(el => el.style.display = 'none');
                const calcSection = document.querySelector('.financial-calculator-section');
                if (calcSection) {
                    setTimeout(() => {
                        calcSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }, 100);
                }
            } else if (section === 'comparison') {
                // Show only the STR vs LTR Comparison section
                if (mainContent) {
                    const allSections = mainContent.querySelectorAll(':scope > *');
                    allSections.forEach(el => {
                        if (el.id === 'property-header-card' || el.id === 'str-ltr-comparison-section') {
                            el.style.display = '';
                        } else {
                            el.style.display = 'none';
                        }
                    });
                }
                // Switch to STR metrics in header (neutral display)
                document.querySelectorAll('.str-metric').forEach(el => el.style.display = '');
                document.querySelectorAll('.ltr-metric').forEach(el => el.style.display = 'none');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
                // Default: show property header and main content (hide LTR, investment grade card, and financial calculator)
                if (mainContent) {
                    const allSections = mainContent.querySelectorAll(':scope > *');
                    allSections.forEach(el => {
                        if (el.id === 'ltr-analysis-section' || 
                            el.id === 'investment-grade-card' || 
                            el.id === 'financial-calculator-section') {
                            el.style.display = 'none';
                        } else {
                            el.style.display = '';
                        }
                    });
                }
                // Switch to STR metrics in header
                document.querySelectorAll('.str-metric').forEach(el => el.style.display = '');
                document.querySelectorAll('.ltr-metric').forEach(el => el.style.display = 'none');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
            
            console.log('Navigating to:', section);
        }
        
        // Initialize page with Overview section active
        document.addEventListener('DOMContentLoaded', function() {
            // Hide all sections except property header and investment grade card
            const mainContent = document.querySelector('main > .container > div[style*="display: flex"] > div[style*="flex: 1"]');
            if (mainContent) {
                const allSections = mainContent.querySelectorAll(':scope > *');
                allSections.forEach(el => {
                    if (el.id === 'property-header-card' || el.id === 'investment-grade-card') {
                        el.style.display = '';
                    } else {
                        el.style.display = 'none';
                    }
                });
            }
        });
        
        // Save Scenario Functionality
        let savedScenarios = [];
        let currentScenarioName = '';
        
        // Full implementation of updateFinancialCalculator
        window.updateFinancialCalculatorFull = function() {
            // Update all slider displays
            updateSimpleCalculator();
            
            // Update STR nightly display
            const strNightly = document.getElementById('strNightlySlider');
            if (strNightly) {
                document.getElementById('strNightlyValue').textContent = '$' + strNightly.value;
            }
            
            // Update STR occupancy display
            const strOccupancy = document.getElementById('strOccupancySlider');
            if (strOccupancy) {
                document.getElementById('strOccupancyValue').textContent = strOccupancy.value + '%';
            }
            
            // Update LTR rent display
            const ltrRent = document.getElementById('ltrRentSlider');
            if (ltrRent) {
                document.getElementById('ltrRentValue').textContent = '$' + parseInt(ltrRent.value).toLocaleString();
            }
            
            // Update management fee display
            const mgmtFee = document.getElementById('mgmtFeeSlider');
            if (mgmtFee) {
                document.getElementById('mgmtFeeValue').textContent = mgmtFee.value + '%';
            }
            
            // Update insurance display
            const insurance = document.getElementById('insuranceSlider');
            if (insurance) {
                document.getElementById('insuranceValue').textContent = '$' + insurance.value + '/mo';
            }
            
            // Update down payment display
            const downPayment = document.getElementById('downPaymentSlider');
            if (downPayment) {
                document.getElementById('downPaymentValue').textContent = downPayment.value + '%';
                const propertyPrice = 849900;
                const downAmount = (propertyPrice * downPayment.value / 100);
                document.getElementById('downPaymentAmount').textContent = '$' + downAmount.toLocaleString();
            }
            
            // Update interest rate display
            const interestRate = document.getElementById('interestRateSlider');
            if (interestRate) {
                document.getElementById('interestRateValue').textContent = interestRate.value + '%';
            }
            
            // Update loan term display
            const loanTerm = document.getElementById('loanTermSlider');
            if (loanTerm) {
                document.getElementById('loanTermValue').textContent = loanTerm.value + ' years';
            }
            
            // Calculate and update mortgage payment
            calculateMortgage();
            
            // Update cash flow calculations and bar chart
            if (document.getElementById('strNightlySlider')) {
                // Get values
                const strNightlyRate = parseFloat(document.getElementById('strNightlySlider').value);
                const strOccupancyRate = parseFloat(document.getElementById('strOccupancySlider').value) / 100;
                const ltrMonthlyRent = parseFloat(document.getElementById('ltrRentSlider').value);
                const propertyTax = parseFloat(document.getElementById('propertyTaxInput').value); // Already monthly
                const insurance = parseFloat(document.getElementById('insuranceSlider').value);
                const mgmtFeePercent = parseFloat(document.getElementById('mgmtFeeSlider').value) / 100;
                
                // Calculate STR revenue and expenses
                const strMonthlyRevenue = strNightlyRate * 30 * strOccupancyRate;
                const strMgmtFee = strMonthlyRevenue * mgmtFeePercent;
                const strMonthlyExpenses = propertyTax + insurance + strMgmtFee + 500; // +$500 for utilities/cleaning
                const strNetCashFlow = strMonthlyRevenue - strMonthlyExpenses;
                
                // Calculate LTR revenue and expenses
                const ltrMonthlyRevenue = ltrMonthlyRent;
                const ltrMgmtFee = ltrMonthlyRevenue * 0.08; // 8% for LTR
                const ltrMonthlyExpenses = propertyTax + insurance + ltrMgmtFee;
                const ltrNetCashFlow = ltrMonthlyRevenue - ltrMonthlyExpenses;
                
                // Include mortgage if financing is enabled
                let mortgagePayment = 0;
                if (document.getElementById('financingToggle').checked) {
                    const mortgageElement = document.getElementById('mortgagePayment');
                    if (mortgageElement) {
                        mortgagePayment = Math.abs(parseFloat(mortgageElement.textContent.replace(/[^0-9.-]/g, '')));
                    }
                }
                
                const strFinalCashFlow = strNetCashFlow - mortgagePayment;
                const ltrFinalCashFlow = ltrNetCashFlow - mortgagePayment;
                
                // Update bar chart
                const strBar = document.getElementById('strBar');
                const ltrBar = document.getElementById('ltrBar');
                const strBarValue = document.getElementById('strBarValue');
                const ltrBarValue = document.getElementById('ltrBarValue');
                
                if (strBar && ltrBar) {
                    // Scale bars (max height 180px for $10k)
                    const maxValue = 10000;
                    const strHeight = Math.min(180, Math.max(10, (strFinalCashFlow / maxValue) * 180));
                    const ltrHeight = Math.min(180, Math.max(10, (ltrFinalCashFlow / maxValue) * 180));
                    
                    strBar.setAttribute('height', Math.abs(strHeight));
                    strBar.setAttribute('y', strFinalCashFlow >= 0 ? (230 - strHeight) : 230);
                    ltrBar.setAttribute('height', Math.abs(ltrHeight));
                    ltrBar.setAttribute('y', ltrFinalCashFlow >= 0 ? (230 - ltrHeight) : 230);
                    
                    strBarValue.textContent = '$' + Math.round(strFinalCashFlow).toLocaleString();
                    ltrBarValue.textContent = '$' + Math.round(ltrFinalCashFlow).toLocaleString();
                }
                
                // Update summary metrics
                const strAdvantage = document.getElementById('strAdvantage');
                const annualDifference = document.getElementById('annualDifference');
                if (strAdvantage) {
                    const monthlyDiff = strFinalCashFlow - ltrFinalCashFlow;
                    strAdvantage.textContent = (monthlyDiff >= 0 ? '+' : '') + '$' + Math.round(monthlyDiff).toLocaleString() + '/mo';
                    annualDifference.textContent = (monthlyDiff >= 0 ? '+' : '') + '$' + Math.round(monthlyDiff * 12).toLocaleString() + '/yr';
                }
            }
        }
        
        function loadPresetScenario(type) {
            // Show the scenarios bar
            document.getElementById('savedScenarios').style.display = 'block';
            
            // Define preset values
            const presets = {
                conservative: {
                    strNightly: 250,
                    strOccupancy: 50,
                    ltrRent: 3500,
                    mgmtFee: 30,
                    insurance: 300,
                    downPayment: 20,
                    interestRate: 7.0,
                    loanTerm: 30
                },
                optimistic: {
                    strNightly: 450,
                    strOccupancy: 85,
                    ltrRent: 4500,
                    mgmtFee: 20,
                    insurance: 200,
                    downPayment: 25,
                    interestRate: 5.5,
                    loanTerm: 30
                },
                market: {
                    strNightly: 363,
                    strOccupancy: 75,
                    ltrRent: 4000,
                    mgmtFee: 25,
                    insurance: 250,
                    downPayment: 20,
                    interestRate: 6.5,
                    loanTerm: 30
                }
            };
            
            const preset = presets[type];
            if (!preset) return;
            
            // Load preset values
            document.getElementById('strNightlySlider').value = preset.strNightly;
            document.getElementById('strOccupancySlider').value = preset.strOccupancy;
            document.getElementById('ltrRentSlider').value = preset.ltrRent;
            document.getElementById('mgmtFeeSlider').value = preset.mgmtFee;
            document.getElementById('insuranceSlider').value = preset.insurance;
            document.getElementById('downPaymentSlider').value = preset.downPayment;
            document.getElementById('interestRateSlider').value = preset.interestRate;
            document.getElementById('loanTermSlider').value = preset.loanTerm;
            
            // Update all displays
            updateFinancialCalculator();
            
            // Update button states
            const buttons = document.querySelectorAll('#savedScenarios .scenario-btn');
            buttons.forEach(btn => {
                btn.classList.remove('active');
                btn.style.border = '1px solid #d1d5db';
            });
            
            // Set active button
            event.target.classList.add('active');
            event.target.style.border = '1px solid #f59e0b';
            
            currentScenarioName = type.charAt(0).toUpperCase() + type.slice(1);
        }
        
        function saveScenario() {
            const name = prompt('Enter a name for this scenario:', `Scenario ${savedScenarios.length + 1}`);
            if (!name) return;
            
            const scenario = {
                name: name,
                strNightly: document.getElementById('strNightlySlider').value,
                strOccupancy: document.getElementById('strOccupancySlider').value,
                ltrRent: document.getElementById('ltrRentSlider').value,
                mgmtFee: document.getElementById('mgmtFeeSlider').value,
                propertyTax: document.getElementById('propertyTaxInput').value,
                insurance: document.getElementById('insuranceSlider').value,
                downPayment: document.getElementById('downPaymentSlider').value,
                interestRate: document.getElementById('interestRateSlider').value,
                loanTerm: document.getElementById('loanTermSlider').value,
                financing: document.getElementById('financingToggle').checked
            };
            
            savedScenarios.push(scenario);
            currentScenarioName = name;
            
            // Show saved scenarios bar
            document.getElementById('savedScenarios').style.display = 'block';
            
            // Add button for this scenario
            const scenariosContainer = document.getElementById('scenarioButtons');
            const newButton = document.createElement('button');
            newButton.className = 'scenario-btn active';
            newButton.style = 'padding: 4px 12px; background: white; border: 1px solid #f59e0b; border-radius: 4px; font-size: 12px; cursor: pointer; margin-right: 8px;';
            newButton.textContent = name;
            newButton.onclick = () => loadScenario(savedScenarios.length - 1);
            
            // Deactivate other buttons
            scenariosContainer.querySelectorAll('.scenario-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.style.border = '1px solid #d1d5db';
            });
            
            scenariosContainer.appendChild(newButton);
            
            alert(`Scenario "${name}" saved successfully!`);
        }
        
        function loadScenario(index) {
            const scenario = savedScenarios[index];
            if (!scenario) return;
            
            // Load all values
            document.getElementById('strNightlySlider').value = scenario.strNightly;
            document.getElementById('strOccupancySlider').value = scenario.strOccupancy;
            document.getElementById('ltrRentSlider').value = scenario.ltrRent;
            document.getElementById('mgmtFeeSlider').value = scenario.mgmtFee;
            document.getElementById('propertyTaxInput').value = scenario.propertyTax;
            document.getElementById('insuranceSlider').value = scenario.insurance;
            document.getElementById('downPaymentSlider').value = scenario.downPayment;
            document.getElementById('interestRateSlider').value = scenario.interestRate;
            document.getElementById('loanTermSlider').value = scenario.loanTerm;
            document.getElementById('financingToggle').checked = scenario.financing;
            
            // Update all displays
            updateFinancialCalculator();
            
            // Update button states
            const buttons = document.querySelectorAll('#savedScenarios .scenario-btn');
            buttons.forEach((btn, i) => {
                if (i === index + 3) { // +3 because first 3 are preset buttons
                    btn.classList.add('active');
                    btn.style.border = '1px solid #f59e0b';
                } else {
                    btn.classList.remove('active');
                    btn.style.border = '1px solid #d1d5db';
                }
            });
            
            currentScenarioName = scenario.name;
        }
        
        function exportToExcel() {
            // Gather all calculation data
            const data = {
                scenario: currentScenarioName || 'Current',
                inputs: {
                    strNightly: document.getElementById('strNightlySlider').value,
                    strOccupancy: document.getElementById('strOccupancySlider').value,
                    ltrRent: document.getElementById('ltrRentSlider').value,
                    propertyTax: document.getElementById('propertyTaxInput').value,
                    insurance: document.getElementById('insuranceSlider').value,
                    downPayment: document.getElementById('downPaymentSlider').value,
                    interestRate: document.getElementById('interestRateSlider').value,
                },
                outputs: {
                    strRevenue: document.getElementById('strRevenueSum').textContent,
                    totalExpenses: document.getElementById('totalExpensesSum').textContent,
                    netIncome: document.getElementById('netIncomeSum').textContent,
                    cashOnCash: document.getElementById('cashOnCash').textContent,
                    capRate: document.getElementById('capRate').textContent
                }
            };
            
            // Create CSV content
            let csv = 'Financial Analysis Export\n\n';
            csv += 'Scenario,' + data.scenario + '\n\n';
            csv += 'Input Parameters\n';
            csv += 'STR Nightly Rate,$' + data.inputs.strNightly + '\n';
            csv += 'STR Occupancy,' + data.inputs.strOccupancy + '%\n';
            csv += 'LTR Monthly Rent,$' + data.inputs.ltrRent + '\n';
            csv += 'Property Tax,$' + data.inputs.propertyTax + '\n';
            csv += 'Insurance,$' + data.inputs.insurance + '/mo\n';
            csv += 'Down Payment,' + data.inputs.downPayment + '%\n';
            csv += 'Interest Rate,' + data.inputs.interestRate + '%\n\n';
            csv += 'Calculated Results\n';
            csv += 'STR Annual Revenue,' + data.outputs.strRevenue + '\n';
            csv += 'Total Expenses,' + data.outputs.totalExpenses + '\n';
            csv += 'Net Income,' + data.outputs.netIncome + '\n';
            csv += 'Cash-on-Cash Return,' + data.outputs.cashOnCash + '\n';
            csv += 'Cap Rate,' + data.outputs.capRate + '\n';
            
            // Create download link
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `financial-analysis-${Date.now()}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            alert('Financial analysis exported to CSV file!');
        }
        
        function toggleSidebar() {
            const sidebar = document.querySelector('aside');
            const collapseBtn = sidebar.querySelector('button[onclick="toggleSidebar()"] svg');
            
            if (sidebar.style.width === '60px') {
                // Expand
                sidebar.style.width = '280px';
                sidebar.classList.remove('sidebar-collapsed');
                collapseBtn.style.transform = 'rotate(0deg)';
                
                // Show text after animation
                setTimeout(() => {
                    sidebar.querySelectorAll('.sidebar-nav-item span, nav + div').forEach(el => {
                        el.style.display = '';
                    });
                }, 150);
            } else {
                // Collapse
                sidebar.querySelectorAll('.sidebar-nav-item span, nav + div').forEach(el => {
                    el.style.display = 'none';
                });
                
                sidebar.style.width = '60px';
                sidebar.classList.add('sidebar-collapsed');
                collapseBtn.style.transform = 'rotate(180deg)';
            }
        }
        
        // Constants
        const PROPERTY_PRICE = 849900;
        
        // Calculate mortgage payment
        function calculateMortgage(principal, rate, years) {
            if (rate === 0) return principal / (years * 12);
            const monthlyRate = rate / 12;
            const numPayments = years * 12;
            return principal * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / 
                   (Math.pow(1 + monthlyRate, numPayments) - 1);
        }
        
        // Update simple STR calculator
        window.updateSimpleCalculator = function() {
            // Get input elements with null checks
            const nightlyRateEl = document.getElementById('nightlyRate');
            const occupancyRateEl = document.getElementById('occupancyRate');
            const cleaningFeeEl = document.getElementById('cleaningFee');
            const ltrRentSliderEl = document.getElementById('ltrRentSlider');
            
            // Return early if critical elements are missing
            if (!nightlyRateEl || !occupancyRateEl || !cleaningFeeEl) {
                console.warn('Simple calculator input elements not found');
                return;
            }
            
            const nightlyRate = parseFloat(nightlyRateEl.value);
            const occupancyRate = parseFloat(occupancyRateEl.value) / 100;
            const cleaningFee = parseFloat(cleaningFeeEl.value);
            
            // Calculate monthly revenue
            const nightsBooked = Math.round(30.4 * occupancyRate);
            const monthlyRevenue = Math.round((nightlyRate * nightsBooked) + (cleaningFee * 4));
            const annualRevenue = monthlyRevenue * 12;
            
            // Update display with null checks
            const nightlyRateValueEl = document.getElementById('nightlyRateValue');
            if (nightlyRateValueEl) nightlyRateValueEl.textContent = `$${nightlyRate}/night`;
            
            const occupancyRateValueEl = document.getElementById('occupancyRateValue');
            if (occupancyRateValueEl) occupancyRateValueEl.textContent = `${Math.round(occupancyRate * 100)}%`;
            
            const cleaningFeeValueEl = document.getElementById('cleaningFeeValue');
            if (cleaningFeeValueEl) cleaningFeeValueEl.textContent = `$${cleaningFee}`;
            
            const monthlyRevenueResultEl = document.getElementById('monthlyRevenueResult');
            if (monthlyRevenueResultEl) monthlyRevenueResultEl.textContent = `$${monthlyRevenue.toLocaleString()}`;
            
            const nightsBookedTextEl = document.getElementById('nightsBookedText');
            if (nightsBookedTextEl) nightsBookedTextEl.textContent = `Based on ${nightsBooked} nights booked per month`;
            
            // Update STR annual revenue display (using existing element)
            const strAnnualRevenueEl = document.getElementById('str-annual-revenue');
            if (strAnnualRevenueEl) strAnnualRevenueEl.textContent = `$${annualRevenue.toLocaleString()}`;
            
            // Also try to update the missing element if it exists
            const annualRevenueCalcEl = document.getElementById('annualRevenueCalc');
            if (annualRevenueCalcEl) annualRevenueCalcEl.textContent = `$${annualRevenue.toLocaleString()}`;
            
            // Update vs LTR comparison
            if (ltrRentSliderEl) {
                const ltrRent = parseFloat(ltrRentSliderEl.value);
                const vsLTR = Math.round(((monthlyRevenue - ltrRent) / ltrRent) * 100);
                const vsLTRCalcEl = document.getElementById('vsLTRCalc');
                if (vsLTRCalcEl) vsLTRCalcEl.textContent = vsLTR > 0 ? `+${vsLTR}%` : `${vsLTR}%`;
            }
        }
        
        window.updateFinancialCalculator = function() {
            // Get all input values
            const strNightlyRate = parseFloat(document.getElementById('strNightlySlider').value);
            const strOccupancy = parseFloat(document.getElementById('strOccupancySlider').value) / 100;
            const ltrRent = parseFloat(document.getElementById('ltrRentSlider').value);
            const mgmtFee = parseFloat(document.getElementById('mgmtFeeSlider').value) / 100;
            
            // Check if financing is enabled
            const financingEnabled = document.getElementById('financingToggle').checked;
            let mortgagePayment = 0;
            let downPaymentAmount = PROPERTY_PRICE; // Default to full price for cash purchase
            
            if (financingEnabled) {
                const downPaymentPercent = parseFloat(document.getElementById('downPaymentSlider').value) / 100;
                const interestRate = parseFloat(document.getElementById('interestRateSlider').value) / 100;
                const loanTerm = parseFloat(document.getElementById('loanTermSlider').value);
                
                downPaymentAmount = PROPERTY_PRICE * downPaymentPercent;
                const loanAmount = PROPERTY_PRICE - downPaymentAmount;
                
                // Calculate mortgage payment
                if (loanAmount > 0) {
                    mortgagePayment = calculateMortgage(loanAmount, interestRate, loanTerm);
                }
                
                // Update financing display
                document.getElementById('downPaymentAmount').textContent = `$${Math.round(downPaymentAmount).toLocaleString()}`;
                document.getElementById('mortgagePayment').textContent = `-$${Math.round(mortgagePayment).toLocaleString()}`;
            }
            
            // Calculate STR revenue and expenses
            const monthlyRevenue = strNightlyRate * 30.4 * strOccupancy;
            const monthlyMgmtFee = monthlyRevenue * mgmtFee;
            const monthlyOperatingExpenses = monthlyMgmtFee + 500; // Base operating expenses
            const strNetCashFlow = monthlyRevenue - mortgagePayment - monthlyOperatingExpenses;
            
            // Calculate LTR cash flow
            const ltrOperatingExpenses = 200; // Lower operating expenses for LTR
            const ltrNetCashFlow = ltrRent - mortgagePayment - ltrOperatingExpenses;
            
            // Update display values
            document.getElementById('strNightlyValue').textContent = `$${strNightlyRate}`;
            document.getElementById('strOccupancyValue').textContent = `${Math.round(strOccupancy * 100)}%`;
            document.getElementById('ltrRentValue').textContent = `$${ltrRent.toLocaleString()}`;
            document.getElementById('mgmtFeeValue').textContent = `${Math.round(mgmtFee * 100)}%`;
            
            if (financingEnabled) {
                document.getElementById('downPaymentValue').textContent = `${document.getElementById('downPaymentSlider').value}%`;
                document.getElementById('interestRateValue').textContent = `${document.getElementById('interestRateSlider').value}%`;
                document.getElementById('loanTermValue').textContent = `${document.getElementById('loanTermSlider').value} years`;
            }
            
            // Update bar chart
            const maxCashFlow = 10000;
            const strBarHeight = Math.max(10, Math.min(180, (strNetCashFlow / maxCashFlow) * 180));
            const strBarY = 230 - strBarHeight;
            
            const ltrBarHeight = Math.max(10, Math.min(180, (ltrNetCashFlow / maxCashFlow) * 180));
            const ltrBarY = 230 - ltrBarHeight;
            
            document.getElementById('strBar').setAttribute('height', strBarHeight);
            document.getElementById('strBar').setAttribute('y', strBarY);
            document.getElementById('strBar').setAttribute('fill', strNetCashFlow >= 0 ? '#10b981' : '#ef4444');
            document.getElementById('strBarValue').textContent = `$${Math.round(strNetCashFlow).toLocaleString()}`;
            document.getElementById('strBarValue').setAttribute('y', strBarY - 10);
            
            document.getElementById('ltrBar').setAttribute('height', ltrBarHeight);
            document.getElementById('ltrBar').setAttribute('y', ltrBarY);
            document.getElementById('ltrBar').setAttribute('fill', ltrNetCashFlow >= 0 ? '#6b7280' : '#ef4444');
            document.getElementById('ltrBarValue').textContent = `$${Math.round(ltrNetCashFlow).toLocaleString()}`;
            document.getElementById('ltrBarValue').setAttribute('y', ltrBarY - 10);
            
            // Update comparison metrics
            const strAdvantage = strNetCashFlow - ltrNetCashFlow;
            document.getElementById('strAdvantage').textContent = 
                strAdvantage >= 0 ? `+$${Math.round(strAdvantage).toLocaleString()}/mo` : 
                `-$${Math.abs(Math.round(strAdvantage)).toLocaleString()}/mo`;
            document.getElementById('annualDifference').textContent = 
                strAdvantage >= 0 ? `+$${Math.round(strAdvantage * 12).toLocaleString()}/yr` : 
                `-$${Math.abs(Math.round(strAdvantage * 12)).toLocaleString()}/yr`;
            
            // Update summary metrics
            const annualRevenue = monthlyRevenue * 12;
            const annualExpenses = (mortgagePayment + monthlyOperatingExpenses) * 12;
            const netAnnualIncome = annualRevenue - annualExpenses;
            
            document.getElementById('strRevenueSum').textContent = `$${Math.round(annualRevenue).toLocaleString()}/yr`;
            document.getElementById('totalExpensesSum').textContent = `-$${Math.round(annualExpenses).toLocaleString()}/yr`;
            document.getElementById('netIncomeSum').textContent = 
                netAnnualIncome >= 0 ? `$${Math.round(netAnnualIncome).toLocaleString()}/yr` : 
                `-$${Math.abs(Math.round(netAnnualIncome)).toLocaleString()}/yr`;
            
            // Calculate returns
            const cashOnCash = downPaymentAmount > 0 ? (netAnnualIncome / downPaymentAmount) * 100 : 0;
            const capRate = (netAnnualIncome / PROPERTY_PRICE) * 100;
            
            document.getElementById('cashOnCash').textContent = `${cashOnCash.toFixed(1)}%`;
            document.getElementById('capRate').textContent = `${capRate.toFixed(1)}%`;
            
            // Update top metrics
            document.getElementById('netCashFlowDisplay').textContent = 
                strNetCashFlow >= 0 ? `+$${Math.round(strNetCashFlow).toLocaleString()}` : 
                `-$${Math.abs(Math.round(strNetCashFlow)).toLocaleString()}`;
            document.getElementById('roiDisplay').textContent = `${cashOnCash.toFixed(1)}%`;
            
            // Update cash flow comparison cards
            document.getElementById('strRevenueCard').textContent = `+$${Math.round(monthlyRevenue).toLocaleString()}`;
            document.getElementById('strMortgageCard').textContent = `-$${Math.round(mortgagePayment).toLocaleString()}`;
            document.getElementById('strExpensesCard').textContent = `-$${Math.round(monthlyOperatingExpenses).toLocaleString()}`;
            document.getElementById('strCashFlowCard').textContent = 
                strNetCashFlow >= 0 ? `+$${Math.round(strNetCashFlow).toLocaleString()}` : 
                `-$${Math.abs(Math.round(strNetCashFlow)).toLocaleString()}`;
            document.getElementById('strCashFlowCard').className = strNetCashFlow >= 0 ? 
                'cashflow-value cashflow-total positive' : 'cashflow-value cashflow-total negative';
            
            document.getElementById('ltrRentCard').textContent = `+$${Math.round(ltrRent).toLocaleString()}`;
            document.getElementById('ltrMortgageCard').textContent = `-$${Math.round(mortgagePayment).toLocaleString()}`;
            document.getElementById('ltrCashFlowCard').textContent = 
                ltrNetCashFlow >= 0 ? `+$${Math.round(ltrNetCashFlow).toLocaleString()}` : 
                `-$${Math.abs(Math.round(ltrNetCashFlow)).toLocaleString()}`;
            document.getElementById('ltrCashFlowCard').className = ltrNetCashFlow >= 0 ? 
                'cashflow-value cashflow-total positive' : 'cashflow-value cashflow-total negative';
        }
        
        // Financing toggle handler
        document.getElementById('financingToggle').addEventListener('change', function() {
            const financingSection = document.getElementById('financingSection');
            if (this.checked) {
                financingSection.classList.remove('disabled');
            } else {
                financingSection.classList.add('disabled');
            }
            updateFinancialCalculator();
        });
        
        // Now that updateFinancialCalculatorFull is defined, update the global reference
        window.updateFinancialCalculator = updateFinancialCalculatorFull;
        
        // Store the function for API integration use
        window.updateFinancialCalculations = updateFinancialCalculatorFull;
        
        // Event listeners for simple calculator
        document.getElementById('nightlyRate').addEventListener('input', updateSimpleCalculator);
        document.getElementById('occupancyRate').addEventListener('input', updateSimpleCalculator);
        document.getElementById('cleaningFee').addEventListener('input', updateSimpleCalculator);
        
        // Event listeners for financial calculator sliders
        const strNightlySliderEl = document.getElementById('strNightlySlider');
        if (strNightlySliderEl) strNightlySliderEl.addEventListener('input', window.updateFinancialCalculator);
        
        const strOccupancySliderEl = document.getElementById('strOccupancySlider');
        if (strOccupancySliderEl) strOccupancySliderEl.addEventListener('input', window.updateFinancialCalculator);
        
        const ltrRentSliderEl2 = document.getElementById('ltrRentSlider');
        if (ltrRentSliderEl2) ltrRentSliderEl2.addEventListener('input', function() {
            window.updateFinancialCalculator();
            window.updateSimpleCalculator(); // Also update simple calculator
        });
        
        const mgmtFeeSliderEl = document.getElementById('mgmtFeeSlider');
        if (mgmtFeeSliderEl) mgmtFeeSliderEl.addEventListener('input', window.updateFinancialCalculator);
        
        const downPaymentSliderEl = document.getElementById('downPaymentSlider');
        if (downPaymentSliderEl) downPaymentSliderEl.addEventListener('input', window.updateFinancialCalculator);
        
        const interestRateSliderEl = document.getElementById('interestRateSlider');
        if (interestRateSliderEl) interestRateSliderEl.addEventListener('input', window.updateFinancialCalculator);
        
        const loanTermSliderEl = document.getElementById('loanTermSlider');
        if (loanTermSliderEl) loanTermSliderEl.addEventListener('input', function() {
            const value = this.value;
            const loanTermValueEl = document.getElementById('loanTermValue');
            if (loanTermValueEl) loanTermValueEl.textContent = value === '1' ? '1 year' : `${value} years`;
            window.updateFinancialCalculator();
        });
        
        // Reset button
        document.getElementById('resetBtn').addEventListener('click', function() {
            // Reset simple calculator
            document.getElementById('nightlyRate').value = 185;
            document.getElementById('occupancyRate').value = 78;
            document.getElementById('cleaningFee').value = 75;
            
            // Reset financial calculator
            document.getElementById('strNightlySlider').value = 363;
            document.getElementById('strOccupancySlider').value = 75;
            document.getElementById('ltrRentSlider').value = 4000;
            document.getElementById('mgmtFeeSlider').value = 25;
            document.getElementById('downPaymentSlider').value = 20;
            document.getElementById('interestRateSlider').value = 6.5;
            document.getElementById('loanTermSlider').value = 30;
            document.getElementById('loanTermValue').textContent = '30 years';
            document.getElementById('financingToggle').checked = true;
            document.getElementById('financingSection').classList.remove('disabled');
            
            window.updateSimpleCalculator();
            window.updateFinancialCalculator();
        });
        
        // LTR Calculator Functions
        function updateLTRCalculator() {
            const monthlyRent = parseFloat(document.getElementById('ltrMonthlyRent').value);
            const vacancyRate = parseFloat(document.getElementById('ltrVacancyRate').value) / 100;
            const annualIncrease = parseFloat(document.getElementById('ltrAnnualIncrease').value) / 100;
            
            // Calculate effective annual income
            const effectiveMonthlyIncome = monthlyRent * (1 - vacancyRate);
            const annualIncome = effectiveMonthlyIncome * 12;
            
            // Calculate 5-year total with annual increases
            let total5Year = 0;
            for (let year = 0; year < 5; year++) {
                total5Year += annualIncome * Math.pow(1 + annualIncrease, year);
            }
            
            // Update displays
            document.getElementById('ltrMonthlyRentValue').textContent = `$${monthlyRent.toLocaleString()}/month`;
            document.getElementById('ltrVacancyRateValue').textContent = `${(vacancyRate * 100).toFixed(0)}%`;
            document.getElementById('ltrAnnualIncreaseValue').textContent = `${(annualIncrease * 100).toFixed(1)}%`;
            
            document.getElementById('ltrAnnualIncome').textContent = `$${Math.round(annualIncome).toLocaleString()}`;
            document.getElementById('ltrEffectiveText').textContent = `After ${(vacancyRate * 100).toFixed(0)}% vacancy rate`;
            document.getElementById('ltr5YearTotal').textContent = `$${Math.round(total5Year).toLocaleString()}`;
            
            // Compare to STR (simplified)
            const strAnnualRevenue = 132000; // From STR calculations
            const difference = ((annualIncome - strAnnualRevenue) / strAnnualRevenue * 100);
            document.getElementById('ltrVsSTR').textContent = `${difference > 0 ? '+' : ''}${difference.toFixed(0)}%`;
        }
        
        // LTR Calculator Event Listeners
        if (document.getElementById('ltrMonthlyRent')) {
            document.getElementById('ltrMonthlyRent').addEventListener('input', updateLTRCalculator);
            document.getElementById('ltrVacancyRate').addEventListener('input', updateLTRCalculator);
            document.getElementById('ltrAnnualIncrease').addEventListener('input', updateLTRCalculator);
        }
        
        // Initial calculations
        window.updateSimpleCalculator();
        window.updateFinancialCalculator();
        if (document.getElementById('ltrMonthlyRent')) {
            updateLTRCalculator();
        }
        
        // LTR Calculator Functions
        function updateLTRCalculator() {
            const monthlyRent = document.getElementById('ltrMonthlyRentNew');
            const vacancyRate = document.getElementById('ltrVacancyRateNew');
            const annualIncrease = document.getElementById('ltrAnnualIncreaseNew');
            
            if (!monthlyRent || !vacancyRate || !annualIncrease) return;
            
            const rent = parseFloat(monthlyRent.value);
            const vacancy = parseFloat(vacancyRate.value) / 100;
            const increase = parseFloat(annualIncrease.value) / 100;
            
            // Update the estimated rent display in the info box
            const estimatedRentDisplay = document.getElementById('estimatedRentDisplay');
            if (estimatedRentDisplay) {
                estimatedRentDisplay.textContent = `$${rent.toLocaleString()}`;
            }
            
            // Update slider labels
            monthlyRent.parentElement.parentElement.querySelector('span').textContent = `$${rent.toLocaleString()}`;
            vacancyRate.parentElement.parentElement.querySelector('span').textContent = `${vacancyRate.value}%`;
            annualIncrease.parentElement.parentElement.querySelector('span').textContent = `${annualIncrease.value}%`;
            
            // Update slider backgrounds
            const rentPercent = ((rent - 2000) / 3000) * 100;
            monthlyRent.style.background = `linear-gradient(to right, var(--primary-blue) ${rentPercent}%, var(--gray-200) ${rentPercent}%)`;
            
            const vacancyPercent = vacancy * 100;
            vacancyRate.style.background = `linear-gradient(to right, var(--primary-blue) ${vacancyPercent}%, var(--gray-200) ${vacancyPercent}%)`;
            
            const increasePercent = (increase * 10) * 10;
            annualIncrease.style.background = `linear-gradient(to right, var(--primary-blue) ${increasePercent}%, var(--gray-200) ${increasePercent}%)`;
            
            // Calculate annual revenue
            const annualRevenue = rent * 12 * (1 - vacancy);
            const ltrAnnualRevenueNewEl = document.getElementById('ltrAnnualRevenueNew');
            if (ltrAnnualRevenueNewEl) {
                ltrAnnualRevenueNewEl.textContent = `$${Math.round(annualRevenue).toLocaleString()}`;
            }
            
            // Update the calculation breakdown section
            const calcBreakdown = document.querySelector('#ltr-analysis-section .card:nth-child(2) span[style*="color: var(--primary-blue)"]');
            if (calcBreakdown) {
                calcBreakdown.textContent = ` $${rent.toLocaleString()}`;
            }
            
            // Update bar chart values
            const year1 = annualRevenue;
            const year3 = annualRevenue * Math.pow(1 + increase, 2);
            const year5 = annualRevenue * Math.pow(1 + increase, 4);
            
            // Update bar labels
            const bars = document.querySelectorAll('#ltr-analysis-section .card > div:last-child > div:last-child > div:first-child > div');
            if (bars.length >= 3) {
                bars[0].querySelector('div:first-child').textContent = `$${Math.round(year1).toLocaleString()}`;
                bars[1].querySelector('div:first-child').textContent = `$${Math.round(year3).toLocaleString()}`;
                bars[2].querySelector('div:first-child').textContent = `$${Math.round(year5).toLocaleString()}`;
                
                // Update bar heights proportionally
                const maxValue = Math.max(year1, year3, year5);
                const baseHeight = 200;
                bars[0].querySelector('div:nth-child(2)').style.height = `${(year1 / maxValue) * baseHeight}px`;
                bars[1].querySelector('div:nth-child(2)').style.height = `${(year3 / maxValue) * baseHeight}px`;
                bars[2].querySelector('div:nth-child(2)').style.height = `${(year5 / maxValue) * baseHeight}px`;
                
                // Update percentage changes
                bars[1].querySelector('div:last-child div:last-child').textContent = `+${((year3 / year1 - 1) * 100).toFixed(1)}%`;
                bars[2].querySelector('div:last-child div:last-child').textContent = `+${((year5 / year1 - 1) * 100).toFixed(1)}%`;
            }
            
            // Update summary stats
            const total5Year = year1 + (year1 * (1 + increase)) + year3 + (year3 * (1 + increase)) + year5;
            const avgAnnual = total5Year / 5;
            
            const summaryStats = document.querySelectorAll('#ltr-analysis-section .card > div:last-child > div:last-child > div:last-child > div');
            if (summaryStats.length >= 2) {
                summaryStats[0].querySelector('div:last-child').textContent = `$${Math.round(total5Year).toLocaleString()}`;
                summaryStats[1].querySelector('div:last-child').textContent = `$${Math.round(avgAnnual).toLocaleString()}`;
            }
        }
        
        // Add event listeners for LTR calculator
        document.addEventListener('DOMContentLoaded', function() {
            const ltrSliders = ['ltrMonthlyRentNew', 'ltrVacancyRateNew', 'ltrAnnualIncreaseNew'];
            ltrSliders.forEach(id => {
                const slider = document.getElementById(id);
                if (slider) {
                    slider.addEventListener('input', updateLTRCalculator);
                }
            });
            
            // Initialize LTR calculator
            updateLTRCalculator();
        });
    </script>

    <!-- Core Modules for Mockup Testing -->
    <script src="./mockup-config.js"></script>
    <script src="./error-recovery.js"></script>
    <script src="./api-integration.js"></script>
    <script src="./extension-handler.js"></script>
    
    <!-- Initialize Mockup Functionality -->
    <script>
        // Initialize mockup when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('[Mockup] Initializing base-mockup.html');
            
            // Show configuration in console
            if (window.mockupConfig) {
                window.mockupConfig.logConfig();
            }
            
            // Handle form submission
            const form = document.getElementById('property-form');
            if (form) {
                form.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    console.log('[Mockup] Form submitted');
                    
                    // Get form data
                    const addressInput = form.querySelector('input[name="address"], input[type="text"]');
                    const address = addressInput ? addressInput.value.trim() : '';
                    
                    if (!address) {
                        alert('Please enter a property address');
                        return;
                    }
                    
                    // Check if we have extension data
                    let analysisData;
                    if (window.extensionHandler?.hasExtensionData()) {
                        console.log('[Mockup] Using extension data');
                        analysisData = window.extensionHandler.getDataForAPI();
                    } else {
                        console.log('[Mockup] Using form address:', address);
                        analysisData = {
                            propertyAddress: address,
                            includeStrAnalysis: true,
                            analysisType: 'both'
                        };
                    }
                    
                    // Analyze property
                    try {
                        console.log('[Mockup] Starting property analysis...');
                        const result = await window.propertyAPI.analyzeProperty(
                            analysisData.propertyAddress,
                            {
                                includeStr: true,
                                analysisType: 'both',
                                showLoading: true,
                                showErrors: true
                            }
                        );
                        
                        console.log('[Mockup] Analysis complete:', result);
                        
                        // Update mockup with results
                        if (result && result.data) {
                            console.log('[Mockup] Updating UI with data:', result.data);
                            // Fix double-wrapped data structure
                            // The API returns {success, data: {success, data: actualData}, message}
                            // But updateMockup expects {data: actualData}
                            const properData = {
                                data: result.data.data || result.data
                            };
                            window.propertyAPI.updateMockup(properData, 'base');
                            
                            // Hide loading states manually if updateMockup doesn't
                            window.propertyAPI.hideLoading('property-header');
                            window.propertyAPI.hideLoading('str-section');
                            window.propertyAPI.hideLoading('ltr-section');
                            
                            // Show success message
                            window.propertyAPI.showSuccessMessage('Property analysis complete! All data has been loaded.');
                        }
                        
                    } catch (error) {
                        console.error('[Mockup] Analysis failed:', error);
                        
                        // Show error recovery UI
                        if (window.errorRecovery) {
                            window.errorRecovery.showErrorUI(error, 'property-hero');
                        } else {
                            alert(`Analysis failed: ${error.message}`);
                        }
                    }
                });
            }
            
            // Handle extension data if present
            if (window.extensionHandler?.hasExtensionData()) {
                console.log('[Mockup] Extension data detected');
                
                // Form will be auto-populated and potentially auto-submitted
                // by the extension handler
            }
            
            // Add event listeners for interactive elements
            
            // Financial calculator updates
            const financialInputs = document.querySelectorAll('#downPaymentSlider, #interestRateSlider, #propertyTaxInput, #insuranceSlider, #hoaInput, #maintenanceSlider, #managementSlider, #vacancySlider');
            financialInputs.forEach(input => {
                input.addEventListener('input', function() {
                    if (typeof updateFinancialCalculatorFull === 'function') {
                        updateFinancialCalculatorFull();
                    }
                });
            });
            
            // STR calculator updates
            const strInputs = document.querySelectorAll('#nightlyRate, #occupancyRate, #cleaningFee');
            strInputs.forEach(input => {
                input.addEventListener('input', function() {
                    if (typeof updateSTRCalculator === 'function') {
                        updateSTRCalculator();
                    }
                });
            });
            
            // Initialize calculators with default values
            if (typeof updateFinancialCalculatorFull === 'function') {
                updateFinancialCalculatorFull();
            }
            if (typeof updateSTRCalculator === 'function') {
                updateSTRCalculator();
            }
            if (typeof updateLTRCalculator === 'function') {
                updateLTRCalculator();
            }
            
            console.log('[Mockup] Initialization complete');
        });
        
        // Add implementation for updateFinancialCalculatorFull if not exists
        if (typeof updateFinancialCalculatorFull === 'undefined') {
            window.updateFinancialCalculatorFull = function() {
                console.log('[Mockup] Updating financial calculator');
                
                // Get property price (use default if not set)
                const propertyPrice = window.propertyPrice || 849900;
                
                // Get input values
                const downPayment = parseInt(document.getElementById('downPaymentSlider')?.value || 20);
                const interestRate = parseFloat(document.getElementById('interestRateSlider')?.value || 6.5);
                const propertyTax = parseInt(document.getElementById('propertyTaxInput')?.value || 708);
                const insurance = parseInt(document.getElementById('insuranceSlider')?.value || 150);
                const hoa = parseInt(document.getElementById('hoaInput')?.value || 0);
                const maintenance = parseInt(document.getElementById('maintenanceSlider')?.value || 200);
                const management = parseInt(document.getElementById('managementSlider')?.value || 0);
                const vacancy = parseInt(document.getElementById('vacancySlider')?.value || 5);
                
                // Calculate mortgage
                const downPaymentAmount = (downPayment / 100) * propertyPrice;
                const loanAmount = propertyPrice - downPaymentAmount;
                const monthlyRate = interestRate / 100 / 12;
                const numPayments = 30 * 12; // 30-year mortgage
                
                let monthlyPayment = 0;
                if (monthlyRate > 0) {
                    monthlyPayment = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / 
                                    (Math.pow(1 + monthlyRate, numPayments) - 1);
                }
                
                // Calculate total monthly costs
                const totalMonthlyCosts = monthlyPayment + propertyTax + insurance + hoa + maintenance + management;
                
                // Update UI
                const updateElement = (id, value) => {
                    const el = document.getElementById(id);
                    if (el) el.textContent = value;
                };
                
                updateElement('monthlyPayment', `$${Math.round(monthlyPayment).toLocaleString()}`);
                updateElement('totalMonthlyCosts', `$${Math.round(totalMonthlyCosts).toLocaleString()}`);
                updateElement('downPaymentAmount', `$${Math.round(downPaymentAmount).toLocaleString()}`);
                updateElement('loanAmount', `$${Math.round(loanAmount).toLocaleString()}`);
                
                // Update metrics if we have rental income
                const strMonthlyRevenue = parseInt(document.getElementById('str-monthly-revenue')?.textContent?.replace(/[$,]/g, '') || 0);
                const ltrMonthlyRent = parseInt(document.getElementById('ltr-monthly-rent')?.textContent?.replace(/[$,]/g, '') || 0);
                
                if (strMonthlyRevenue > 0) {
                    const strProfit = strMonthlyRevenue - totalMonthlyCosts;
                    updateElement('str-monthly-profit', `$${Math.round(strProfit).toLocaleString()}`);
                    
                    const strROI = ((strProfit * 12) / downPaymentAmount * 100).toFixed(1);
                    updateElement('str-roi', `${strROI}%`);
                }
                
                if (ltrMonthlyRent > 0) {
                    const ltrProfit = ltrMonthlyRent - totalMonthlyCosts;
                    updateElement('ltr-monthly-profit', `$${Math.round(ltrProfit).toLocaleString()}`);
                    
                    const ltrROI = ((ltrProfit * 12) / downPaymentAmount * 100).toFixed(1);
                    updateElement('ltr-roi', `${ltrROI}%`);
                }
                
                console.log('[Mockup] Financial calculator updated');
            };
        }
    </script>

    <!-- PDF Generation Modal and Scripts -->
    <div id="pdfReportModal" style="display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.5); z-index: 9999; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 12px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; margin: 20px;">
            <div style="padding: 24px; border-bottom: 1px solid var(--gray-200);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 class="h2">Customize Your Report</h2>
                    <button onclick="closePDFModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--gray-400);">√ó</button>
                </div>
                <p style="margin-top: 8px; color: var(--gray-600);">Select the sections you want to include in your PDF report</p>
            </div>
            
            <div style="padding: 24px;">
                <!-- Report Sections -->
                <div style="margin-bottom: 24px;">
                    <h3 class="h3" style="margin-bottom: 16px;">Report Sections</h3>
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="section-executive" checked style="width: 20px; height: 20px;">
                            <span>Executive Summary</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="section-property" checked style="width: 20px; height: 20px;">
                            <span>Property Details</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="section-financial" checked style="width: 20px; height: 20px;">
                            <span>Financial Analysis</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="section-ltr" checked style="width: 20px; height: 20px;">
                            <span>Long-term Rental Analysis</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="section-str" checked style="width: 20px; height: 20px;">
                            <span>Short-term Rental Analysis</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="section-comparison" checked style="width: 20px; height: 20px;">
                            <span>STR vs LTR Comparison</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="section-recommendations" checked style="width: 20px; height: 20px;">
                            <span>Investment Recommendations</span>
                        </label>
                    </div>
                </div>
                
                <!-- Report Format -->
                <div style="margin-bottom: 24px;">
                    <h3 class="h3" style="margin-bottom: 16px;">Report Format</h3>
                    <div style="display: flex; gap: 12px;">
                        <label style="flex: 1; padding: 12px; border: 2px solid var(--primary-blue); border-radius: 8px; cursor: pointer; text-align: center;">
                            <input type="radio" name="format" value="detailed" checked style="margin-right: 8px;">
                            <span>Detailed Report</span>
                        </label>
                        <label style="flex: 1; padding: 12px; border: 2px solid var(--gray-300); border-radius: 8px; cursor: pointer; text-align: center;">
                            <input type="radio" name="format" value="summary" style="margin-right: 8px;">
                            <span>Summary Report</span>
                        </label>
                    </div>
                </div>
                
                <!-- Realtor Information -->
                <div style="margin-bottom: 24px;">
                    <h3 class="h3" style="margin-bottom: 16px;">Realtor Information (Optional)</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <input type="text" id="realtor-name" placeholder="Your Name" style="padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px;">
                        <input type="text" id="realtor-company" placeholder="Company Name" style="padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px;">
                        <input type="tel" id="realtor-phone" placeholder="Phone Number" style="padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px;">
                        <input type="email" id="realtor-email" placeholder="Email Address" style="padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px;">
                    </div>
                </div>
                
                <!-- Custom Notes -->
                <div style="margin-bottom: 24px;">
                    <h3 class="h3" style="margin-bottom: 16px;">Custom Notes for Client</h3>
                    <textarea id="custom-notes" rows="4" placeholder="Add any personalized notes or recommendations for your client..." 
                              style="width: 100%; padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px; resize: vertical;"></textarea>
                </div>
                
                <!-- Action Buttons -->
                <div style="display: flex; gap: 12px;">
                    <button onclick="generatePDFReport()" id="generateBtn" style="flex: 1; padding: 12px; background: var(--primary-blue); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                        Generate PDF Report
                    </button>
                    <button onclick="closePDFModal()" style="flex: 1; padding: 12px; background: white; color: var(--gray-700); border: 1px solid var(--gray-300); border-radius: 8px; font-weight: 600; cursor: pointer;">
                        Cancel
                    </button>
                </div>
                
                <!-- Progress/Status -->
                <div id="pdfStatus" style="margin-top: 16px; padding: 12px; background: var(--gray-50); border-radius: 8px; display: none;">
                    <div id="statusText" style="color: var(--gray-700); font-weight: 500;"></div>
                    <div id="downloadLink" style="margin-top: 8px;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Load jsPDF from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // PDF Generation Functions
        function openPDFModal() {
            const modal = document.getElementById('pdfReportModal');
            modal.style.display = 'flex';
        }
        
        function closePDFModal() {
            const modal = document.getElementById('pdfReportModal');
            modal.style.display = 'none';
            
            // Reset status
            const statusDiv = document.getElementById('pdfStatus');
            statusDiv.style.display = 'none';
        }
        
        async function generatePDFReport() {
            const statusDiv = document.getElementById('pdfStatus');
            const statusText = document.getElementById('statusText');
            const downloadDiv = document.getElementById('downloadLink');
            const generateBtn = document.getElementById('generateBtn');
            
            // Show status
            statusDiv.style.display = 'block';
            statusText.textContent = 'Generating PDF...';
            downloadDiv.innerHTML = '';
            generateBtn.disabled = true;
            
            try {
                // Get selected sections
                const selectedSections = {
                    executiveSummary: document.getElementById('section-executive').checked,
                    propertyDetails: document.getElementById('section-property').checked,
                    financialAnalysis: document.getElementById('section-financial').checked,
                    longTermRental: document.getElementById('section-ltr').checked,
                    shortTermRental: document.getElementById('section-str').checked,
                    comparison: document.getElementById('section-comparison').checked,
                    recommendations: document.getElementById('section-recommendations').checked
                };
                
                // Get realtor info
                const realtorInfo = {
                    name: document.getElementById('realtor-name').value,
                    company: document.getElementById('realtor-company').value,
                    phone: document.getElementById('realtor-phone').value,
                    email: document.getElementById('realtor-email').value
                };
                
                // Get custom notes
                const customNotes = document.getElementById('custom-notes').value;
                
                // Get report format
                const format = document.querySelector('input[name="format"]:checked').value;
                
                // Generate PDF with jsPDF
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Add content
                let yPosition = 20;
                
                // Title
                doc.setFontSize(20);
                doc.text('Property Investment Analysis Report', 20, yPosition);
                yPosition += 15;
                
                // Property Address
                doc.setFontSize(14);
                doc.text('1514 - 150 East Liberty Street', 20, yPosition);
                yPosition += 8;
                doc.text('Toronto, Ontario M6K 3R5', 20, yPosition);
                yPosition += 15;
                
                // Date
                doc.setFontSize(10);
                doc.text(`Generated: ${new Date().toLocaleDateString()}`, 20, yPosition);
                yPosition += 15;
                
                // Add realtor info if provided
                if (realtorInfo.name) {
                    doc.setFontSize(12);
                    doc.text('Prepared by:', 20, yPosition);
                    yPosition += 8;
                    doc.setFontSize(10);
                    doc.text(realtorInfo.name, 20, yPosition);
                    yPosition += 6;
                    if (realtorInfo.company) {
                        doc.text(realtorInfo.company, 20, yPosition);
                        yPosition += 6;
                    }
                    if (realtorInfo.phone) {
                        doc.text(realtorInfo.phone, 20, yPosition);
                        yPosition += 6;
                    }
                    if (realtorInfo.email) {
                        doc.text(realtorInfo.email, 20, yPosition);
                        yPosition += 6;
                    }
                    yPosition += 10;
                }
                
                // Add sections based on selection
                if (selectedSections.executiveSummary) {
                    doc.setFontSize(14);
                    doc.text('Executive Summary', 20, yPosition);
                    yPosition += 8;
                    doc.setFontSize(10);
                    doc.text('Investment Grade: B+', 20, yPosition);
                    yPosition += 6;
                    doc.text('Strong LTR opportunity with restricted STR potential due to regulations.', 20, yPosition);
                    yPosition += 15;
                }
                
                if (selectedSections.propertyDetails) {
                    if (yPosition > 250) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    doc.setFontSize(14);
                    doc.text('Property Details', 20, yPosition);
                    yPosition += 8;
                    doc.setFontSize(10);
                    doc.text('Price: $849,900', 20, yPosition);
                    yPosition += 6;
                    doc.text('Bedrooms: 2 | Bathrooms: 2 | Size: 1,200 sq ft', 20, yPosition);
                    yPosition += 6;
                    doc.text('Property Type: Condo | Year Built: 2018', 20, yPosition);
                    yPosition += 15;
                }
                
                if (selectedSections.financialAnalysis) {
                    if (yPosition > 250) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    doc.setFontSize(14);
                    doc.text('Financial Analysis', 20, yPosition);
                    yPosition += 8;
                    doc.setFontSize(10);
                    doc.text('Down Payment (20%): $169,980', 20, yPosition);
                    yPosition += 6;
                    doc.text('Monthly Mortgage: $3,200', 20, yPosition);
                    yPosition += 6;
                    doc.text('Property Tax: $650/month', 20, yPosition);
                    yPosition += 6;
                    doc.text('HOA Fees: $450/month', 20, yPosition);
                    yPosition += 15;
                }
                
                if (selectedSections.shortTermRental) {
                    if (yPosition > 250) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    doc.setFontSize(14);
                    doc.text('Short-Term Rental Analysis', 20, yPosition);
                    yPosition += 8;
                    doc.setFontSize(10);
                    doc.text('Status: RESTRICTED - Not permitted due to zoning regulations', 20, yPosition);
                    yPosition += 6;
                    doc.text('Potential Revenue (if allowed): $11,044/month', 20, yPosition);
                    yPosition += 6;
                    doc.text('Average Daily Rate: $375', 20, yPosition);
                    yPosition += 6;
                    doc.text('Occupancy Rate: 75%', 20, yPosition);
                    yPosition += 15;
                }
                
                if (selectedSections.longTermRental) {
                    if (yPosition > 250) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    doc.setFontSize(14);
                    doc.text('Long-Term Rental Analysis', 20, yPosition);
                    yPosition += 8;
                    doc.setFontSize(10);
                    doc.text('Monthly Rent: $3,950', 20, yPosition);
                    yPosition += 6;
                    doc.text('Monthly Cash Flow: $1,200', 20, yPosition);
                    yPosition += 6;
                    doc.text('Annual ROI: 11.7%', 20, yPosition);
                    yPosition += 6;
                    doc.text('Vacancy Rate: 5%', 20, yPosition);
                    yPosition += 15;
                }
                
                // Add custom notes if provided
                if (customNotes) {
                    if (yPosition > 230) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    doc.setFontSize(14);
                    doc.text('Additional Notes', 20, yPosition);
                    yPosition += 8;
                    doc.setFontSize(10);
                    const lines = doc.splitTextToSize(customNotes, 170);
                    doc.text(lines, 20, yPosition);
                }
                
                // Convert PDF to base64
                const pdfBase64 = doc.output('datauristring');
                
                // Simulate Firebase upload (in real test, this would use Firebase MCP)
                const fileName = `reports/mockup-test-${Date.now()}.pdf`;
                
                // Show success message
                statusText.textContent = '‚úÖ PDF Generated Successfully!';
                statusText.style.color = 'var(--success-green)';
                
                // Create download link
                const downloadLink = document.createElement('a');
                downloadLink.href = pdfBase64;
                downloadLink.download = fileName;
                downloadLink.textContent = 'üì• Download PDF Report';
                downloadLink.style.color = 'var(--primary-blue)';
                downloadLink.style.textDecoration = 'none';
                downloadLink.style.fontWeight = '600';
                downloadDiv.appendChild(downloadLink);
                
                // Log for testing
                console.log('[Mockup] PDF generated:', {
                    fileName,
                    sections: selectedSections,
                    realtorInfo,
                    format,
                    customNotes: customNotes ? 'Yes' : 'No'
                });
                
                // Note: In actual implementation with Firebase MCP, we would:
                // 1. Upload the base64 PDF to Firebase Storage
                // 2. Create a Firestore document with report metadata
                // 3. Get the download URL from Firebase Storage
                
            } catch (error) {
                statusText.textContent = '‚ùå Error generating PDF';
                statusText.style.color = 'var(--danger-red)';
                console.error('[Mockup] PDF generation error:', error);
            } finally {
                generateBtn.disabled = false;
            }
        }
        
        // Wire up the Generate PDF button in sidebar
        document.addEventListener('DOMContentLoaded', function() {
            // Find the Generate PDF button and add click handler
            const pdfButtons = document.querySelectorAll('button');
            pdfButtons.forEach(button => {
                if (button.textContent.includes('Generate PDF Report')) {
                    button.onclick = openPDFModal;
                }
            });
        });
    </script>