<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STR Header Fix Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .status-pass { background: #10b981; color: white; }
        .status-fail { background: #ef4444; color: white; }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">STR Tab Property Header Test</h1>
        
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Test Results</h2>
            <div id="test-results" class="space-y-2"></div>
        </div>
        
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-4">Component Preview</h2>
            <div id="component-container"></div>
        </div>
    </div>

    <script type="module">
        import { AirbnbHeroSectionMockup } from './components/analysis/AirbnbListingsMockup.js';
        
        // Test data with property image and details
        const testPropertyImage = 'https://photos.zolo.ca/1080-greenwood-avenue-unit-309-toronto-C8196906-1-p.jpg';
        
        const testAnalysisData = {
            // Test property_data (snake_case from API)
            property_data: {
                address: '1080 Greenwood Avenue Unit 309, Toronto, ON',
                price: 650000,
                bedrooms: 2,
                bathrooms: 2,
                sqft: 1100,
                mainImage: testPropertyImage,
                propertyType: 'Condo'
            },
            strAnalysis: {
                avgNightlyRate: 185,
                occupancy_rate: 0.72,
                monthly_revenue: 4050,
                comparables: []
            },
            longTermRental: {
                monthly_rent: 2800
            }
        };
        
        // Simulate the mapAnalysisData function
        function mapAnalysisData(data) {
            if (data.property_data && !data.propertyData) {
                data.propertyData = {
                    ...data.property_data,
                    mainImage: data.property_data.mainImage || data.property_data.image || data.property_data.imageUrl
                };
            }
            return data;
        }
        
        // Run tests
        function runTests() {
            const results = document.getElementById('test-results');
            const tests = [];
            
            // Test 1: Check if mapAnalysisData works
            const mappedData = mapAnalysisData({...testAnalysisData});
            tests.push({
                name: 'Data Mapping (property_data â†’ propertyData)',
                passed: mappedData.propertyData !== undefined,
                detail: mappedData.propertyData ? 'propertyData created successfully' : 'Failed to create propertyData'
            });
            
            // Test 2: Check if mainImage is preserved
            tests.push({
                name: 'Property Image Mapping',
                passed: mappedData.propertyData?.mainImage === testPropertyImage,
                detail: mappedData.propertyData?.mainImage || 'No image found'
            });
            
            // Test 3: Check property details
            tests.push({
                name: 'Property Details',
                passed: mappedData.propertyData?.bedrooms === 2 && mappedData.propertyData?.bathrooms === 2,
                detail: `${mappedData.propertyData?.bedrooms || '?'} BR, ${mappedData.propertyData?.bathrooms || '?'} BA, ${mappedData.propertyData?.sqft || '?'} sqft`
            });
            
            // Test 4: Render component
            try {
                const html = AirbnbHeroSectionMockup({ analysis: mappedData });
                document.getElementById('component-container').innerHTML = html;
                
                // Check if image is in the HTML
                const hasImage = html.includes(testPropertyImage);
                tests.push({
                    name: 'Component Rendering',
                    passed: hasImage,
                    detail: hasImage ? 'Property image included in HTML' : 'Property image missing from HTML'
                });
                
                // Check if property details are in the HTML
                const hasDetails = html.includes('2 Bedrooms') && html.includes('2 Bathrooms');
                tests.push({
                    name: 'Property Details in HTML',
                    passed: hasDetails,
                    detail: hasDetails ? 'Property details rendered correctly' : 'Property details missing'
                });
                
            } catch (error) {
                tests.push({
                    name: 'Component Rendering',
                    passed: false,
                    detail: `Error: ${error.message}`
                });
            }
            
            // Display results
            results.innerHTML = tests.map(test => `
                <div class="flex items-center justify-between p-3 rounded ${test.passed ? 'bg-green-50' : 'bg-red-50'}">
                    <div>
                        <span class="font-medium">${test.name}</span>
                        <span class="text-sm text-gray-600 ml-2">${test.detail}</span>
                    </div>
                    <span class="px-3 py-1 rounded text-sm font-bold ${test.passed ? 'status-pass' : 'status-fail'}">
                        ${test.passed ? 'PASS' : 'FAIL'}
                    </span>
                </div>
            `).join('');
            
            // Log for debugging
            console.log('Original data:', testAnalysisData);
            console.log('Mapped data:', mappedData);
            console.log('Property data:', mappedData.propertyData);
        }
        
        // Run tests on load
        runTests();
        
        // Initialize charts after a delay
        setTimeout(() => {
            const event = new Event('DOMContentLoaded');
            document.dispatchEvent(event);
        }, 100);
    </script>
</body>
</html>