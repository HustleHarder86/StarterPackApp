<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROI Finder - Test Version</title>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="styles/compact-modern-design-system.css">
    <link rel="stylesheet" href="styles/gradient-theme.css">
    <link rel="stylesheet" href="styles/mobile-fixes.css">
    <link rel="stylesheet" href="styles/glass-override.css">
    <link rel="stylesheet" href="styles/design-system.css">
    
    <!-- React from CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Manrope Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <div id="root"></div>
    
    <!-- Load Components in correct order -->
    <script src="components/layout/CompactModernLayout.js"></script>
    <script src="components/analysis/PropertyHeroSection.js"></script>
    <script src="components/analysis/FinancialSummaryCompactModern.js"></script>
    <script src="components/analysis/InvestmentVerdictCompactModern.js"></script>
    <script src="components/analysis/MarketComparisonCompactModern.js"></script>
    
    <!-- Load Module System -->
    <script src="js/modules/componentLoader.js"></script>
    <script>
        // Wait for ComponentLoader to be defined before loading CompactModern
        if (window.ComponentLoader) {
            const script = document.createElement('script');
            script.src = 'js/modules/componentLoaderCompactModern.js';
            document.head.appendChild(script);
        }
    </script>
    
    <!-- Test Mode Initialization -->
    <script>
        // Check for test mode
        const urlParams = new URLSearchParams(window.location.search);
        const isTestMode = urlParams.get('e2e_test_mode') === 'true';
        
        if (isTestMode) {
            console.log('[TEST MODE] Running in E2E test mode');
            
            // Mock Firebase for test mode
            window.firebase = {
                auth: () => ({
                    onAuthStateChanged: (callback) => {
                        // Simulate authenticated user
                        callback({ uid: 'test-user', email: 'test@example.com' });
                    },
                    signOut: () => Promise.resolve()
                }),
                firestore: () => ({
                    collection: () => ({
                        doc: () => ({
                            get: () => Promise.resolve({ exists: () => false }),
                            set: () => Promise.resolve()
                        })
                    })
                }),
                initializeApp: () => {}
            };
            
            // Mock Firebase UI
            window.firebaseui = {
                auth: {
                    AuthUI: class {
                        start() {}
                        delete() { return Promise.resolve(); }
                    }
                }
            };
        }
    </script>
    
    <!-- Initialize Application -->
    <script>
        // Delay initialization to ensure all scripts are loaded
        window.addEventListener('load', function() {
            setTimeout(function() {
                console.log('[INIT] DOM loaded, initializing application');
                
                // Verify all components are loaded
                const componentsToCheck = [
                    'ComponentLoader',
                    'ComponentLoaderCompactModern',
                    'CompactModernLayout',
                    'PropertyHeroSection',
                    'FinancialSummaryCompactModern',
                    'InvestmentVerdictCompactModern',
                    'MarketComparisonCompactModern'
                ];
                
                const missingComponents = componentsToCheck.filter(name => !window[name]);
                if (missingComponents.length > 0) {
                    console.error('[INIT] Missing components:', missingComponents);
                    return;
                }
                
                console.log('[INIT] All components loaded successfully');
                
                // Initialize component loader
                window.componentLoader = new window.ComponentLoaderCompactModern();
                console.log('[INIT] Component loader initialized');
                
                // Render basic form for testing
                const root = document.getElementById('root');
            root.innerHTML = `
                <div class="cm-layout-wrapper">
                    <aside class="cm-sidebar" id="sidebarContainer">
                        <div class="cm-sidebar-header">
                            <h1 class="cm-logo">ROI Finder</h1>
                        </div>
                        <nav class="cm-sidebar-nav">
                            <a href="#" class="cm-nav-link cm-nav-link-active">
                                <i class="fas fa-calculator"></i>
                                <span>Analysis</span>
                            </a>
                        </nav>
                    </aside>
                    
                    <main class="cm-main-content">
                        <div class="cm-content-container">
                            <div class="cm-page-header">
                                <h1 class="cm-page-title">Property Analysis</h1>
                            </div>
                            
                            <form id="property-form" class="cm-analysis-form">
                                <div class="cm-form-group">
                                    <label for="address">Property Address</label>
                                    <input type="text" id="address" name="address" required>
                                </div>
                                
                                <div class="cm-form-group">
                                    <label for="city">City</label>
                                    <input type="text" id="city" name="city" required>
                                </div>
                                
                                <div class="cm-form-group">
                                    <label for="price">Listing Price</label>
                                    <input type="number" id="price" name="price" required>
                                </div>
                                
                                <button type="submit" class="cm-submit-button">
                                    Analyze Property
                                </button>
                            </form>
                            
                            <div id="results-container"></div>
                        </div>
                    </main>
                </div>
            `;
            
            // Add form submission handler
            const form = document.getElementById('property-form');
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                console.log('[FORM] Form submitted');
                
                // Mock analysis for testing
                const resultsContainer = document.getElementById('results-container');
                resultsContainer.innerHTML = '<div class="cm-loading">Analyzing property...</div>';
                
                setTimeout(() => {
                    resultsContainer.innerHTML = '<div class="cm-success">Analysis complete!</div>';
                }, 1000);
            });
            
            console.log('[INIT] Application initialized successfully');
            }, 100); // End setTimeout
        }); // End window.onload
    </script>
</body>
</html>