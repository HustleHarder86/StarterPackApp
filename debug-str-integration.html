<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>STR Integration Debugger</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- Load Component -->
  <script type="text/babel" src="/components/RentalComparisonView.jsx"></script>
  
  <style>
    .status-ok { color: #10b981; }
    .status-error { color: #ef4444; }
    .status-warning { color: #f59e0b; }
    pre { background: #f3f4f6; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; }
  </style>
</head>
<body class="bg-gray-100 p-8">
  <div class="max-w-6xl mx-auto">
    <h1 class="text-3xl font-bold mb-8">STR Integration Debugger</h1>
    
    <!-- Status Dashboard -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
      <h2 class="text-xl font-semibold mb-4">System Status</h2>
      <div id="status-checks" class="space-y-2"></div>
    </div>
    
    <!-- Component Test -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
      <h2 class="text-xl font-semibold mb-4">Component Test</h2>
      <div class="space-y-4">
        <button onclick="testComponentMount()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
          Test Component Mount
        </button>
        <button onclick="testWithMockData()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
          Test with Mock Data
        </button>
        <button onclick="clearComponent()" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
          Clear Component
        </button>
      </div>
      
      <!-- Component Container -->
      <div id="str-comparison-container" class="mt-6" style="display: none;"></div>
    </div>
    
    <!-- Debug Console -->
    <div class="bg-white rounded-lg shadow-md p-6">
      <h2 class="text-xl font-semibold mb-4">Debug Console</h2>
      <pre id="debug-console" class="text-sm"></pre>
    </div>
  </div>
  
  <script>
    const debugLog = [];
    
    function log(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      const entry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
      debugLog.push(entry);
      document.getElementById('debug-console').textContent = debugLog.join('\n');
      console.log(entry);
    }
    
    function checkStatus() {
      const checks = [
        {
          name: 'React Loaded',
          test: () => typeof React !== 'undefined',
          details: () => React ? `Version: ${React.version}` : 'Not loaded'
        },
        {
          name: 'ReactDOM Loaded',
          test: () => typeof ReactDOM !== 'undefined',
          details: () => ReactDOM ? `Version: ${ReactDOM.version}` : 'Not loaded'
        },
        {
          name: 'Babel Loaded',
          test: () => typeof Babel !== 'undefined',
          details: () => 'Babel standalone loaded'
        },
        {
          name: 'RentalComparisonView Component',
          test: () => typeof window.RentalComparisonView !== 'undefined',
          details: () => window.RentalComparisonView ? 'Component available' : 'Not loaded'
        },
        {
          name: 'Container Element',
          test: () => document.getElementById('str-comparison-container') !== null,
          details: () => 'Container div present'
        }
      ];
      
      const statusContainer = document.getElementById('status-checks');
      statusContainer.innerHTML = '';
      
      checks.forEach(check => {
        const passed = check.test();
        const status = passed ? 'ok' : 'error';
        const icon = passed ? '✅' : '❌';
        const details = check.details();
        
        const div = document.createElement('div');
        div.className = `flex justify-between items-center p-2 border-b`;
        div.innerHTML = `
          <span>${icon} ${check.name}</span>
          <span class="status-${status} text-sm">${details}</span>
        `;
        statusContainer.appendChild(div);
      });
    }
    
    function testComponentMount() {
      log('Testing component mount...');
      
      try {
        const container = document.getElementById('str-comparison-container');
        if (!container) {
          log('Container not found!', 'error');
          return;
        }
        
        container.style.display = 'block';
        
        if (typeof window.RentalComparisonView === 'undefined') {
          log('Component not loaded! Waiting for Babel...', 'warning');
          
          // Wait for Babel to process
          setTimeout(() => {
            if (typeof window.RentalComparisonView !== 'undefined') {
              log('Component loaded after wait!', 'success');
              testComponentMount(); // Retry
            } else {
              log('Component still not available', 'error');
            }
          }, 1000);
          return;
        }
        
        // Create minimal test data
        const testData = {
          longTermRental: {
            monthlyRent: 1000,
            annualRevenue: 12000,
            annualProfit: 6000
          }
        };
        
        ReactDOM.render(
          React.createElement(window.RentalComparisonView, {
            analysis: testData,
            propertyAddress: 'Test Property'
          }),
          container
        );
        
        log('Component mounted successfully!', 'success');
      } catch (error) {
        log(`Mount error: ${error.message}`, 'error');
        console.error(error);
      }
    }
    
    function testWithMockData() {
      log('Testing with full mock data...');
      
      try {
        const container = document.getElementById('str-comparison-container');
        if (!container) {
          log('Container not found!', 'error');
          return;
        }
        
        container.style.display = 'block';
        
        if (typeof window.RentalComparisonView === 'undefined') {
          log('Component not loaded!', 'error');
          return;
        }
        
        // Full mock data
        const mockData = {
          propertyDetails: {
            estimatedValue: 850000
          },
          longTermRental: {
            monthlyRent: 2500,
            rentRange: { low: 2300, high: 2700 },
            vacancyRate: 5,
            annualRevenue: 30000,
            annualExpenses: 15000,
            annualProfit: 15000,
            cashFlow: 1250,
            capRate: 5.2,
            comparables: [
              'Similar property at 123 Oak St renting for $2,400/month',
              'Comparable unit at 456 Elm Ave renting for $2,600/month'
            ]
          },
          strAnalysis: {
            avgNightlyRate: 150,
            occupancyRate: 70,
            annualRevenue: 38325,
            annualExpenses: 18325,
            annualProfit: 20000,
            monthlyRevenue: 3194,
            comparables: []
          },
          comparison: {
            betterStrategy: 'str',
            monthlyIncomeDiff: 694,
            annualIncomeDiff: 8325,
            annualProfitDiff: 5000,
            percentageIncrease: 33,
            breakEvenOccupancy: 55,
            recommendation: 'Short-term rental is recommended for this property based on the analysis.',
            riskAssessment: 'STR has higher income potential but requires more active management.'
          }
        };
        
        ReactDOM.render(
          React.createElement(window.RentalComparisonView, {
            analysis: mockData,
            propertyAddress: '789 Maple Drive, Toronto, ON'
          }),
          container
        );
        
        log('Component mounted with full data!', 'success');
      } catch (error) {
        log(`Mount error: ${error.message}`, 'error');
        console.error(error);
      }
    }
    
    function clearComponent() {
      const container = document.getElementById('str-comparison-container');
      if (container) {
        ReactDOM.unmountComponentAtNode(container);
        container.style.display = 'none';
        container.innerHTML = '';
        log('Component cleared', 'info');
      }
    }
    
    // Run initial checks
    window.addEventListener('load', () => {
      log('Page loaded, running initial checks...');
      checkStatus();
      
      // Check again after a delay for Babel
      setTimeout(() => {
        log('Rechecking after Babel processing...');
        checkStatus();
      }, 2000);
    });
    
    // Also check on Babel ready
    if (typeof Babel !== 'undefined') {
      log('Babel is ready');
    }
  </script>
</body>
</html>