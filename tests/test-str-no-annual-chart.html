<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test STR Tab - No Annual Revenue Chart</title>
    <link rel="stylesheet" href="../styles/design-system.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #f9fafb; }
        .tab-content { display: none; }
        .tab-content:not(.hidden) { display: block; }
    </style>
</head>
<body>
    <div class="min-h-screen bg-gray-50 py-8">
        <div class="max-w-7xl mx-auto px-4">
            <h1 class="text-2xl font-bold mb-6">Test: STR Tab Without Annual Revenue Chart</h1>
            
            <!-- Tab Navigation -->
            <div class="bg-white rounded-lg shadow-lg mb-8">
                <div class="p-4 rounded-t-lg border-b border-gray-200">
                    <div class="flex flex-wrap gap-2">
                        <button id="str-tab" onclick="switchTab('str')" 
                            class="tab-button bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg border-transparent transform scale-105 flex items-center gap-2 px-4 py-3 rounded-lg border-2 font-medium transition-all duration-200">
                            <span class="text-xl">üè†</span>
                            <div class="text-left">
                                <div class="font-semibold">Short-Term Rental</div>
                                <div class="text-xs text-blue-100">Airbnb & VRBO Analysis</div>
                            </div>
                            <span class="ml-2 text-white">‚úì</span>
                        </button>
                    </div>
                </div>
                
                <div class="p-6">
                    <!-- STR Content -->
                    <div id="str-content" class="tab-content">
                        <div id="str-tab-content">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Financial Summary Section -->
            <div id="financial-summary-content">Loading financial summary...</div>
        </div>
    </div>

    <script type="module">
        // Mock analysis data
        const mockAnalysisData = {
            propertyData: {
                address: '2302 - 82, DALHOUSIE STREET Toronto, Ontario, M5B 0C5',
                price: 635000,
                bedrooms: 2,
                bathrooms: 2,
                squareFeet: 650,
                propertyTaxes: 5490,
                condoFees: 480,
                mainImage: 'https://images.unsplash.com/photo-1568605114967-8130f3a36994?w=800&h=600&fit=crop'
            },
            strAnalysis: {
                monthlyRevenue: 8704,
                avgNightlyRate: 409,
                occupancy_rate: 0.71,
                comparables: [
                    {
                        title: "Luxury 2BR Downtown Toronto",
                        nightly_rate: 261,
                        occupancy_rate: 0.90,
                        monthly_revenue: 7047,
                        bedrooms: 2,
                        bathrooms: 2,
                        rating: 4.9,
                        reviewCount: 89,
                        image_url: { url: 'https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?w=600&h=400&fit=crop' },
                        url: '#'
                    },
                    {
                        title: "Modern 2BR Condo King West",
                        nightly_rate: 369,
                        occupancy_rate: 0.75,
                        monthly_revenue: 8303,
                        bedrooms: 2,
                        bathrooms: 2,
                        rating: 4.8,
                        reviewCount: 156,
                        image_url: { url: 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=600&h=400&fit=crop' },
                        url: '#'
                    },
                    {
                        title: "Cozy 1BR+Den Financial District",
                        nightly_rate: 539,
                        occupancy_rate: 0.80,
                        monthly_revenue: 12936,
                        bedrooms: 1,
                        bathrooms: 1,
                        rating: 4.7,
                        reviewCount: 234,
                        image_url: { url: 'https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?w=600&h=400&fit=crop' },
                        url: '#'
                    }
                ]
            },
            longTermRental: {
                monthlyRent: 3132,
                cashFlow: -5572
            },
            costs: {
                totalMonthly: 2464,
                property_tax_annual: 5490,
                insurance_annual: 2540,
                hoa_monthly: 480
            },
            metrics: {},
            overallScore: 8.2
        };

        // Load components
        async function loadComponents() {
            try {
                // Load STR component
                const strModule = await import('../components/analysis/AirbnbListingsMockup.js');
                const strHtml = strModule.AirbnbHeroSectionMockup({ analysis: mockAnalysisData });
                document.getElementById('str-tab-content').innerHTML = strHtml;

                // Load Financial Summary component (without annual revenue chart)
                const financialModule = await import('../components/analysis/EnhancedFinancialSummary.js');
                const financialHtml = financialModule.EnhancedFinancialSummary({ analysis: mockAnalysisData });
                document.getElementById('financial-summary-content').innerHTML = financialHtml;

                // Initialize STR components
                const strChartsModule = await import('../js/modules/strCharts.js');
                if (strChartsModule.initializeSTRComponents) {
                    setTimeout(() => {
                        strChartsModule.initializeSTRComponents(mockAnalysisData);
                    }, 100);
                }

                // Initialize financial summary
                if (financialModule.initializeEnhancedFinancialSummary) {
                    setTimeout(() => {
                        financialModule.initializeEnhancedFinancialSummary();
                    }, 100);
                }

                // Initialize financial calculator charts
                const calcChartsModule = await import('../js/modules/financialCalculatorCharts.js');
                if (calcChartsModule.initializeEnhancedFinancialCalculator) {
                    setTimeout(() => {
                        calcChartsModule.initializeEnhancedFinancialCalculator();
                    }, 200);
                }

            } catch (error) {
                console.error('Error loading components:', error);
                document.getElementById('str-tab-content').innerHTML = `
                    <div class="text-red-600 p-4 bg-red-50 rounded">
                        Error loading components: ${error.message}
                    </div>
                `;
            }
        }

        // Tab switching
        window.switchTab = function(tab) {
            console.log('Switching to tab:', tab);
        };

        // Stub functions for buttons
        window.saveAnalysis = () => alert('Save analysis - test mode');
        window.generateReport = () => alert('Generate report - test mode');
        window.shareAnalysis = () => alert('Share analysis - test mode');
        window.analyzeAnother = () => alert('Analyze another - test mode');
        window.showAllComparables = () => alert('Show all comparables - test mode');
        window.scrollToCalculator = () => {
            document.getElementById('str-calculator-section')?.scrollIntoView({ behavior: 'smooth' });
        };

        // Load on page ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadComponents);
        } else {
            loadComponents();
        }
    </script>
</body>
</html>